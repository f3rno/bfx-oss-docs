<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width,initial-scale=1"><meta charset="utf-8"><link rel="stylesheet" type="text/css" href="css/normalize.css"><link rel="stylesheet" type="text/css" href="css/perfect-scrollbar.css"><link rel="stylesheet" type="text/css" href="css/highlightjs/night-owl.css"><link rel="stylesheet" type="text/css" href="index.css"><title>README | wasteland</title></head><body><div id="bfx-oss-docs-side-bar"><div id="bfx-oss-docs-side-bar__header"><img src="img/bfx-logo-bg-white.png" alt="Bitfinex" height="63"></div><ul><li><a href="index.html"><p>Home</p></a></li><li><a href="page_md_render_test.html"><p>Markdown Render Test</p></a></li><li><a href="page_libraries_bitfinex_api_py_README.html"><img src="svg/icons/python.svg"><p>bitfinex-api-py</p></a></li><li><a href="page_libraries_bfx_hf_strategy_py_README.html"><img src="svg/icons/python.svg"><p>bfx-hf-strategy-py</p></a></li><li><a href="page_libraries_bfx_hf_indicators_py_README.html"><img src="svg/icons/python.svg"><p>bfx-hf-indicators-py</p></a></li><li><a href="page_libraries_bitfinex_api_go_README.html"><img src="svg/icons/go.svg"><p>bitfinex-api-go</p></a></li><li><a href="page_libraries_bfxfixgw_README.html"><img src="svg/icons/go.svg"><p>bfxfixgw</p></a></li><li><a href="page_libraries_bitfinex_api_rb_README.html"><img src="svg/icons/ruby.svg"><p>bitfinex-api-rb</p></a></li><li><a href="page_libraries_bitfinex_api_node_README.html"><img src="svg/icons/nodejs_small.svg"><p>bitfinex-api-node</p></a></li><li><a href="page_libraries_bfx_api_mock_srv_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-mock-srv</p></a></li><li><a href="page_libraries_bfx_api_node_core_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-core</p></a></li><li><a href="page_libraries_bfx_api_node_models_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-models</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_example_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-example</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_managed_candles_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-managed-candles</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_managed_ob_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-managed-ob</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_ob_checksum_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-ob-checksum</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_seq_audit_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-seq-audit</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_wd_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-wd</p></a></li><li><a href="page_libraries_bfx_api_node_rest_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-rest</p></a></li><li><a href="page_libraries_bfx_api_node_util_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-util</p></a></li><li><a href="page_libraries_bfx_api_node_ws1_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-ws1</p></a></li><li><a href="page_libraries_bfx_hf_backtest_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-backtest</p></a></li><li><a href="page_libraries_bfx_hf_chart_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-chart</p></a></li><li><a href="page_libraries_bfx_hf_data_server_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-data-server</p></a></li><li><a href="page_libraries_bfx_hf_ext_plugin_bitfinex_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-ext-plugin-bitfinex</p></a></li><li><a href="page_libraries_bfx_hf_ext_plugin_dummy_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-ext-plugin-dummy</p></a></li><li><a href="page_libraries_bfx_hf_indicators_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-indicators</p></a></li><li><a href="page_libraries_bfx_hf_models_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-models</p></a></li><li><a href="page_libraries_bfx_hf_models_adapter_lowdb_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-lowdb</p></a></li><li><a href="page_libraries_bfx_hf_models_adapter_sql_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-sql</p></a></li><li><a href="page_libraries_bfx_hf_models_adapter_template_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-template</p></a></li><li><a href="page_libraries_bfx_hf_algo_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-algo</p></a></li><li><a href="page_libraries_bfx_hf_server_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-server</p></a></li><li><a href="page_libraries_bfx_hf_strategy_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-strategy</p></a></li><li><a href="page_libraries_bfx_hf_strategy_exec_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-strategy-exec</p></a></li><li><a href="page_libraries_bfx_hf_ui_config_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-ui-config</p></a></li><li><a href="page_libraries_bfx_hf_util_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-util</p></a></li><li><a href="page_libraries_bfx_ws2_api_audit_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-ws2-api-audit</p></a></li><li><a href="page_libraries_cbq_js_README.html"><img src="svg/icons/nodejs_small.svg"><p>cbq-js</p></a></li><li><a href="page_libraries_caron_README.html"><img src="svg/icons/nodejs_small.svg"><p>caron</p></a></li><li><a href="page_libraries_eos_name_verify_README.html"><img src="svg/icons/nodejs_small.svg"><p>eos-name-verify</p></a></li><li><a href="page_libraries_grenache_browser_http_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-browser-http</p></a></li><li><a href="page_libraries_grenache_grape_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-grape</p></a></li><li><a href="page_libraries_grenache_nodejs_base_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-base</p></a></li><li><a href="page_libraries_grenache_nodejs_http_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-http</p></a></li><li><a href="page_libraries_grenache_nodejs_link_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-link</p></a></li><li><a href="page_libraries_grenache_nodejs_utp_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-utp</p></a></li><li><a href="page_libraries_grenache_nodejs_ws_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-ws</p></a></li><li><a href="page_libraries_grenache_nodejs_ws_tls_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-ws-tls</p></a></li><li><a href="page_libraries_lib_js_util_currencies_README.html"><img src="svg/icons/nodejs_small.svg"><p>lib-js-util-currencies</p></a></li><li><a href="page_libraries_lib_js_util_math_README.html"><img src="svg/icons/nodejs_small.svg"><p>lib-js-util-math</p></a></li><li><a href="page_libraries_lib_js_util_number_README.html"><img src="svg/icons/nodejs_small.svg"><p>lib-js-util-number</p></a></li><li><a href="page_libraries_lib_js_util_symbol_README.html"><img src="svg/icons/nodejs_small.svg"><p>lib-js-util-symbol</p></a></li><li><a href="page_libraries_smidgen_README.html"><img src="svg/icons/nodejs_small.svg"><p>smidgen</p></a></li><li><a href="page_libraries_sunbeam_README.html"><img src="svg/icons/nodejs_small.svg"><p>sunbeam</p></a></li><li class="active"><a href="page_libraries_wasteland_README.html"><img src="svg/icons/nodejs_small.svg"><p>wasteland</p></a><ul><li class="active"><a href="page_libraries_wasteland_README.html"><p>- README</p></a></li><li><a href="page_libraries_wasteland_reference.html"><p>- API Reference</p></a></li></ul></li></ul></div><div id="bfx-oss-docs-content"><div id="bfx-oss-docs-header-bar"><h2>README</h2><h2>wasteland</h2></div><div id="bfx-oss-docs-content-wrapper" class="bfx-oss-docs-content-type-api-docs"><div class="bfx-oss-docs-md-content bfx-oss-docs-code-wrapper"><div id="bfx-oss-docs-api-docs-index"><div id="bfx-oss-docs-api-docs-index__inner"><nav class="bfx-oss-docs-md-toc"><ol><li><a href="#wasteland">wasteland</a><ol><li><a href="#mutable-data">Mutable Data</a></li><li><a href="#immutable-data">Immutable Data</a></li><li><a href="#storage-backends">Storage Backends</a><ol><li><a href="#example-using-grenache%3A">Example using Grenache:</a></li><li><a href="#custom-backends">Custom Backends</a></li></ol></li><li><a href="#data-model">Data Model</a><ol><li><a href="#wasteland-pointers">Wasteland pointers</a></li><li><a href="#bep-44-data-models">BEP 44 data models</a></li></ol></li></ol></li></ol></nav></div></div><h1 id="wasteland"><a class="header-anchor" href="#wasteland">§</a> wasteland</h1><p>Wasteland is a modular data layer for <a href="http://www.bittorrent.org/beps/bep_0044.html">storing data in DHT</a> and other backends. Storage adapters are pluggable, right now Grenache (DHT) and in-memory backends are included.</p><p>As payload size is limited to <a href="http://www.bittorrent.org/beps/bep_0044.html">1000 bytes per spec</a>, DHT storage supports chunking with indirect pointers. We can store 996 chars in a 1000 byte buffer, and 22 pointers per 1000 bytes, so with just single indirect pointers we can store up to 21.912KB.</p><h2 id="mutable-data"><a class="header-anchor" href="#mutable-data">§</a> Mutable Data</h2><p>Data updates and update conflicts: for data updates a <code>seq</code> property must be used, which increases monotonically. This way we can make sure that a client does not overwrite outdated data. Updates and conflicts have to get handled at the client side, specific to the use case (e.g. “last-write-wins” or manual conflict resolution).</p><p>Salts are used to store different values with the same key pair. If the salt is omitted, Wasteland generates it. For data that is stored in chunks, the salt is generated by hashing the stored data plus a random modifier.</p><p>Data is signed using public/private keys (ed25519).</p><p>You can find examples for both mutable and immutable data in <a href="/examples/">the examples folder</a>.</p><h2 id="immutable-data"><a class="header-anchor" href="#immutable-data">§</a> Immutable Data</h2><p>Immutable data is not signed. It is just a hash of the stored content. That means there can be no duplicate content. In case of duplicate content the write succeed, and return the same hash as for the previous result. The hash that is also used as key / storage address is simply a hash of the stored content.</p><p>You can find examples for both mutable and immutable data in <a href="/examples/">the examples folder</a>.</p><h2 id="storage-backends"><a class="header-anchor" href="#storage-backends">§</a> Storage Backends</h2><p>Wasteland comes with backends for Grenache and In-Memory storage. Plugging in new backends is no problem.</p><h3 id="example-using-grenache%3A"><a class="header-anchor" href="#example-using-grenache%3A">§</a> Example using Grenache:</h3><p>Run two Grapes:</p><pre><code class="hljs"><span class="hljs-string">grape </span><span class="hljs-built_in">--dp</span> <span class="hljs-string">20001 </span><span class="hljs-built_in">--aph</span> <span class="hljs-string">30001 </span><span class="hljs-built_in">--bn</span> <span class="hljs-string">'127.0.0.1:20002'</span>
<span class="hljs-string">grape </span><span class="hljs-built_in">--dp</span> <span class="hljs-string">20002 </span><span class="hljs-built_in">--aph</span> <span class="hljs-string">40001 </span><span class="hljs-built_in">--bn</span> <span class="hljs-string">'127.0.0.1:20001'</span>
</code></pre><pre><code class="hljs language-js"><span class="hljs-keyword">const</span> Wasteland = <span class="hljs-built_in">require</span>(<span class="hljs-string">'wasteland'</span>)
<span class="hljs-keyword">const</span> GrenacheBackend = <span class="hljs-built_in">require</span>(<span class="hljs-string">'wasteland/backends/Grenache'</span>)

<span class="hljs-keyword">const</span> Link = <span class="hljs-built_in">require</span>(<span class="hljs-string">'grenache-nodejs-link'</span>)
<span class="hljs-keyword">const</span> ed = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ed25519-supercop'</span>)

<span class="hljs-keyword">const</span> link = <span class="hljs-keyword">new</span> Link({
  <span class="hljs-attr">grape</span>: <span class="hljs-string">'http://127.0.0.1:30001'</span>
})
link.start()

<span class="hljs-keyword">const</span> { publicKey, secretKey } = ed.createKeyPair(ed.createSeed())

<span class="hljs-keyword">const</span> gb = <span class="hljs-keyword">new</span> GrenacheBackend({
  <span class="hljs-attr">transport</span>: link,
  <span class="hljs-attr">keys</span>: { publicKey, secretKey }
})

<span class="hljs-keyword">const</span> wl = <span class="hljs-keyword">new</span> Wasteland({ <span class="hljs-attr">backend</span>: gb })

<span class="hljs-keyword">const</span> opts = { <span class="hljs-attr">seq</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">salt</span>: <span class="hljs-string">'pineapple-salt'</span> }
wl.put(<span class="hljs-string">'unchunked-data'</span>, opts, (err, hash) =&gt; {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err

  wl.get({ <span class="hljs-attr">hash</span>: hash, <span class="hljs-attr">salt</span>: <span class="hljs-string">'pineapple-salt'</span> }, {}, (err, data) =&gt; {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err

    <span class="hljs-built_in">console</span>.log(data)
    cb(<span class="hljs-literal">null</span>)
  })
})

</code></pre><p><strong>Response:</strong></p><pre><code class="hljs language-js">{ <span class="hljs-attr">id</span>: <span class="hljs-string">'1da41d4e30c74fa5b0d9a7e4cf60c1bf9402b0f1'</span>,
  <span class="hljs-attr">token</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">v</span>: <span class="hljs-string">'unchunked-data'</span>,
  <span class="hljs-attr">sig</span>: <span class="hljs-string">'f84062a412736d3219bcf7fd40fee911427d03391bd455a53545f971f2eac20b85aed3dac8baafee777905becbcfff312a47bd5aa50aa66f040e39b8e5739901'</span>,
  <span class="hljs-attr">k</span>: <span class="hljs-string">'e33a423dcbf900727afcaf16622ad3263104874dc3031260eb82825db3ae7c2a'</span>,
  <span class="hljs-attr">salt</span>: <span class="hljs-string">'pineapple-salt'</span>,
  <span class="hljs-attr">seq</span>: <span class="hljs-number">1</span> }
</code></pre><p><a href="./examples/grenache.js">grenache.js</a></p><h3 id="custom-backends"><a class="header-anchor" href="#custom-backends">§</a> Custom Backends</h3><h2 id="data-model"><a class="header-anchor" href="#data-model">§</a> Data Model</h2><h3 id="wasteland-pointers"><a class="header-anchor" href="#wasteland-pointers">§</a> Wasteland pointers</h3><p>Pointers to data or other pointers are stored in the following format:</p><pre><code class="hljs">{ wasteland_type: 'pointers',
  p:
   [ [ '8e<span class="hljs-number">6543</span>9da41c<span class="hljs-number">026351</span>2d965af3b45e<span class="hljs-number">750379</span>f808',
       '109eb3bb524d9fce41af8b232b<span class="hljs-number">1435</span>3ec922f357' ],
     [ '<span class="hljs-number">0533</span>d23c50b8e9a33ab89dd9a2f1cb<span class="hljs-number">3323695375</span>',
       '9c<span class="hljs-number">5519</span>b713a16afd0f411b7b<span class="hljs-number">5372</span>0f508dcf<span class="hljs-number">6319</span>' ] ] }
</code></pre><p>In this case the first chunk has the hash <code>8e65439da41c0263512d965af3b45e750379f808</code> and because it is stored as mutable, it has a salt of <code>109eb3bb524d9fce41af8b232b14353ec922f357</code>.</p><p>The second chunk has the hash <code>0533d23c50b8e9a33ab89dd9a2f1cb3323695375</code> and the salt <code>9c5519b713a16afd0f411b7b53720f508dcf6319</code>.</p><p>Immutable data has no salt, so the second index is <code>null</code>:</p><pre><code class="hljs">{ wasteland_type: 'pointers',
  p:
   [ [ '<span class="hljs-number">346543</span>9da41c<span class="hljs-number">026351</span>2d965af3b45e<span class="hljs-number">750379</span>f808',
       <span class="hljs-literal">null</span> ],
     [ 'ea33d23c50b8e9a33ab89dd9a2f1cb<span class="hljs-number">3323695375</span>',
       <span class="hljs-literal">null</span> ] ] }
</code></pre><h3 id="bep-44-data-models"><a class="header-anchor" href="#bep-44-data-models">§</a> BEP 44 data models</h3><p>These are the data models each storage-backend has to implement.</p><p><strong>get Responses:</strong></p><pre><code class="hljs">{
  <span class="hljs-string">"id"</span>: &lt;20 byte id of sending node/database (<span class="hljs-name"><span class="hljs-builtin-name">string</span></span>)&gt;,
  <span class="hljs-string">"seq"</span>: &lt;monotonically increasing sequence number (<span class="hljs-name"><span class="hljs-builtin-name">integer</span></span>), used for versioning&gt;,
  <span class="hljs-string">"sig"</span>: &lt;ed25519 signature (<span class="hljs-number">64</span> bytes string)&gt;,
  <span class="hljs-string">"v"</span>: &lt;the data payload&gt;,
  <span class="hljs-string">"k"</span>: &lt;ed25519 public key&gt;
}
</code></pre></div></div><!--
      <div id="bfx-oss-docs-footer-bar">
        <div id="bfx-oss-docs-footer-bar__container">
          <p>Copyright © 2013-2020 iFinex Inc. All rights reserved.</p>
        </div>
      </div>
      --></div><script type="text/javascript" src="js/vendor/debug.min.js"></script><script type="text/javascript" src="js/vendor/lodash.min.js"></script><script type="text/javascript" src="js/vendor/zepto.min.js"></script><script type="text/javascript" src="js/vendor/perfect-scrollbar.min.js"></script><script type="text/javascript" src="js/main.js"></script></body></html>