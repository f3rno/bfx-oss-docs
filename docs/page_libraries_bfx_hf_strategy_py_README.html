<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width,initial-scale=1"><meta charset="utf-8"><link rel="stylesheet" type="text/css" href="css/normalize.css"><link rel="stylesheet" type="text/css" href="css/perfect-scrollbar.css"><link rel="stylesheet" type="text/css" href="css/highlightjs/night-owl.css"><link rel="stylesheet" type="text/css" href="index.css"><title>README | bfx-hf-strategy-py</title></head><body><div id="bfx-oss-docs-side-bar"><div id="bfx-oss-docs-side-bar__header"><img src="img/bfx-logo-bg-white.png" alt="Bitfinex" height="63"></div><ul><li><a href="index.html"><p>Home</p></a></li><li><a href="page_md_render_test.html"><p>Markdown Render Test</p></a></li><li><a href="page_libraries_bitfinex_api_py_README.html"><img src="svg/icons/python.svg"><p>bitfinex-api-py</p></a></li><li class="active"><a href="page_libraries_bfx_hf_strategy_py_README.html"><img src="svg/icons/python.svg"><p>bfx-hf-strategy-py</p></a><ul><li class="active"><a href="page_libraries_bfx_hf_strategy_py_README.html"><p>- README</p></a></li></ul></li><li><a href="page_libraries_bfx_hf_indicators_py_README.html"><img src="svg/icons/python.svg"><p>bfx-hf-indicators-py</p></a></li><li><a href="page_libraries_bitfinex_api_go_README.html"><img src="svg/icons/go.svg"><p>bitfinex-api-go</p></a></li><li><a href="page_libraries_bfxfixgw_README.html"><img src="svg/icons/go.svg"><p>bfxfixgw</p></a></li><li><a href="page_libraries_bitfinex_api_rb_README.html"><img src="svg/icons/ruby.svg"><p>bitfinex-api-rb</p></a></li><li><a href="page_libraries_bitfinex_api_node_README.html"><img src="svg/icons/nodejs_small.svg"><p>bitfinex-api-node</p></a></li><li><a href="page_libraries_bfx_api_mock_srv_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-mock-srv</p></a></li><li><a href="page_libraries_bfx_api_node_core_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-core</p></a></li><li><a href="page_libraries_bfx_api_node_models_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-models</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_example_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-example</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_managed_candles_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-managed-candles</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_managed_ob_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-managed-ob</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_ob_checksum_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-ob-checksum</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_seq_audit_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-seq-audit</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_wd_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-wd</p></a></li><li><a href="page_libraries_bfx_api_node_rest_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-rest</p></a></li><li><a href="page_libraries_bfx_api_node_util_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-util</p></a></li><li><a href="page_libraries_bfx_api_node_ws1_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-ws1</p></a></li><li><a href="page_libraries_bfx_hf_backtest_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-backtest</p></a></li><li><a href="page_libraries_bfx_hf_chart_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-chart</p></a></li><li><a href="page_libraries_bfx_hf_data_server_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-data-server</p></a></li><li><a href="page_libraries_bfx_hf_ext_plugin_bitfinex_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-ext-plugin-bitfinex</p></a></li><li><a href="page_libraries_bfx_hf_ext_plugin_dummy_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-ext-plugin-dummy</p></a></li><li><a href="page_libraries_bfx_hf_indicators_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-indicators</p></a></li><li><a href="page_libraries_bfx_hf_models_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-models</p></a></li><li><a href="page_libraries_bfx_hf_models_adapter_lowdb_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-lowdb</p></a></li><li><a href="page_libraries_bfx_hf_models_adapter_sql_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-sql</p></a></li><li><a href="page_libraries_bfx_hf_models_adapter_template_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-template</p></a></li><li><a href="page_libraries_bfx_hf_algo_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-algo</p></a></li><li><a href="page_libraries_bfx_hf_server_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-server</p></a></li><li><a href="page_libraries_bfx_hf_strategy_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-strategy</p></a></li><li><a href="page_libraries_bfx_hf_strategy_exec_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-strategy-exec</p></a></li><li><a href="page_libraries_bfx_hf_ui_config_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-ui-config</p></a></li><li><a href="page_libraries_bfx_hf_util_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-util</p></a></li><li><a href="page_libraries_bfx_ws2_api_audit_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-ws2-api-audit</p></a></li><li><a href="page_libraries_cbq_js_README.html"><img src="svg/icons/nodejs_small.svg"><p>cbq-js</p></a></li><li><a href="page_libraries_caron_README.html"><img src="svg/icons/nodejs_small.svg"><p>caron</p></a></li><li><a href="page_libraries_eos_name_verify_README.html"><img src="svg/icons/nodejs_small.svg"><p>eos-name-verify</p></a></li><li><a href="page_libraries_grenache_browser_http_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-browser-http</p></a></li><li><a href="page_libraries_grenache_grape_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-grape</p></a></li><li><a href="page_libraries_grenache_nodejs_base_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-base</p></a></li><li><a href="page_libraries_grenache_nodejs_http_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-http</p></a></li><li><a href="page_libraries_grenache_nodejs_link_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-link</p></a></li><li><a href="page_libraries_grenache_nodejs_utp_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-utp</p></a></li><li><a href="page_libraries_grenache_nodejs_ws_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-ws</p></a></li><li><a href="page_libraries_grenache_nodejs_ws_tls_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-ws-tls</p></a></li><li><a href="page_libraries_lib_js_util_currencies_README.html"><img src="svg/icons/nodejs_small.svg"><p>lib-js-util-currencies</p></a></li><li><a href="page_libraries_lib_js_util_math_README.html"><img src="svg/icons/nodejs_small.svg"><p>lib-js-util-math</p></a></li><li><a href="page_libraries_lib_js_util_number_README.html"><img src="svg/icons/nodejs_small.svg"><p>lib-js-util-number</p></a></li><li><a href="page_libraries_lib_js_util_symbol_README.html"><img src="svg/icons/nodejs_small.svg"><p>lib-js-util-symbol</p></a></li><li><a href="page_libraries_smidgen_README.html"><img src="svg/icons/nodejs_small.svg"><p>smidgen</p></a></li><li><a href="page_libraries_sunbeam_README.html"><img src="svg/icons/nodejs_small.svg"><p>sunbeam</p></a></li><li><a href="page_libraries_wasteland_README.html"><img src="svg/icons/nodejs_small.svg"><p>wasteland</p></a></li></ul></div><div id="bfx-oss-docs-content"><div id="bfx-oss-docs-header-bar"><h2>README</h2><h2>bfx-hf-strategy-py</h2></div><div id="bfx-oss-docs-content-wrapper" class="bfx-oss-docs-content-type-api-docs"><div class="bfx-oss-docs-md-content bfx-oss-docs-code-wrapper"><div id="bfx-oss-docs-api-docs-index"><div id="bfx-oss-docs-api-docs-index__inner"><nav class="bfx-oss-docs-md-toc"><ol><li><a href="#execute">Execute</a></li><li><a href="#honey-framework-for-python">Honey Framework for Python</a></li><li><a href="#features">Features</a></li><li><a href="#quickstart">Quickstart</a><ol><li><a href="#defining-a-strategy">Defining a strategy</a></li><li><a href="#update-handlers">Update Handlers</a></li><li><a href="#managing-positions">Managing positions</a></li></ol></li><li><a href="#backtesting">Backtesting</a><ol><li><a href="#offline">Offline</a></li><li><a href="#data-server">Data server</a></li><li><a href="#live-backtesting">Live backtesting</a></li><li><a href="#live-trading">Live trading</a></li></ol></li><li><a href="#examples">Examples</a></li></ol></nav></div></div><pre><code class="hljs language-python"><span class="hljs-keyword">from</span> hfstrategy <span class="hljs-keyword">import</span> Strategy
<span class="hljs-keyword">from</span> bfxhfindicators <span class="hljs-keyword">import</span> EMA

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EMAStrategy</span><span class="hljs-params">(Strategy)</span>:</span>
  indicators = {
    <span class="hljs-string">'emaL'</span>: EMA([<span class="hljs-number">100</span>]),
    <span class="hljs-string">'emaS'</span>: EMA([<span class="hljs-number">20</span>])
  }

  <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">onEnter</span><span class="hljs-params">(self, update)</span>:</span>
    iv = self.indicatorValues()
    emaS = self.indicators[<span class="hljs-string">'emaS'</span>]
    <span class="hljs-keyword">if</span> emaS.crossed(iv[<span class="hljs-string">'emaL'</span>]):
      <span class="hljs-keyword">await</span> self.openLongPositionMarket(
          mtsCreate=update[<span class="hljs-string">'mts'</span>], price=update[<span class="hljs-string">'price'</span>], amount=<span class="hljs-number">0.1</span>)
  
  <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">onUpdateLong</span><span class="hljs-params">(self, update)</span>:</span>
    iv = self.indicatorValues()
    <span class="hljs-keyword">if</span> iv[<span class="hljs-string">'emaS'</span>] &lt; l:
      <span class="hljs-keyword">await</span> self.closePositionMarket(
          price=update[<span class="hljs-string">'price'</span>], mtsCreate=update[<span class="hljs-string">'mts'</span>])

</code></pre><h3 id="execute"><a class="header-anchor" href="#execute">§</a> Execute</h3><pre><code class="hljs language-python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> hfstrategy <span class="hljs-keyword">import</span> executeLive
executeLive(strategy, os.getenv(<span class="hljs-string">"BFX_KEY"</span>), os.getenv(<span class="hljs-string">"BFX_SECRET"</span>))
</code></pre><h1 id="honey-framework-for-python"><a class="header-anchor" href="#honey-framework-for-python">§</a> Honey Framework for Python</h1><p>This repo serves as a framework for creating trading bots/strategies on the Bitfinex platform. It consists of a set of order methods and an architecture compatible with bfx-hf-data-server and bfx-hf-backtest for backtests on historical candle/trade data, which can be transitioned seamlessly to trading on the live markets.</p><p>Strategies written using this framework must define a set of update methods, called on each tick (with either a trade or a candle), along with a set of indicators which are automatically updated on each tick. The indicators are made available to the strategy methods, and can be queried to direct trading behavior.</p><p>Install bfx-hf-indicators-py:</p><pre><code class="hljs language-sh">git <span class="hljs-built_in">clone</span> https://github.com/bitfinexcom/bfx-hf-indicators-py
<span class="hljs-built_in">cd</span> bfx-hf-indicators-py
<span class="hljs-built_in">export</span> PYTHONPATH=<span class="hljs-string">"<span class="hljs-variable">$(pwd)</span>:<span class="hljs-variable">$PYTHONPATH</span>"</span>
</code></pre><p>Run example ema_cross backtest:</p><pre><code class="hljs language-sh"><span class="hljs-comment"># in bfx-strategy-hf-py</span>
<span class="hljs-built_in">cd</span> examples
python3 ema_cross.py  
</code></pre><h1 id="features"><a class="header-anchor" href="#features">§</a> Features</h1><ul><li>Execute on Live or with backtest data</li><li>Realtime data feeds</li><li>Simple interface</li><li>Quick websocket connections</li><li>Open/Close/Update positions</li></ul><h1 id="quickstart"><a class="header-anchor" href="#quickstart">§</a> Quickstart</h1><h2 id="defining-a-strategy"><a class="header-anchor" href="#defining-a-strategy">§</a> Defining a strategy</h2><p>To define a trading strategy, first we have to create a new object that implements the <code>hfstrategy</code> class. Then we need to decide on a set of indicators to use and bind them to the classes <code>indicators</code> variable. Strategies created with it can be used with bfx-hf-backtest or with the exec method to run on the live market. An example strategy follows below:</p><pre><code class="hljs language-python"><span class="hljs-keyword">from</span> hfstrategy <span class="hljs-keyword">import</span> Strategy
<span class="hljs-keyword">from</span> bfxhfindicators <span class="hljs-keyword">import</span> EMA

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EMAStrategy</span><span class="hljs-params">(Strategy)</span>:</span>
  indicators = {
    <span class="hljs-string">'emaL'</span>: EMA([<span class="hljs-number">100</span>]),
    <span class="hljs-string">'emaS'</span>: EMA([<span class="hljs-number">20</span>])
  }

  <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">onEnter</span><span class="hljs-params">(self, update)</span>:</span>
    <span class="hljs-comment"># Do something</span>
  
  <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">onUpdateLong</span><span class="hljs-params">(self, update)</span>:</span>
    <span class="hljs-comment"># Do something</span>
</code></pre><p>The above strategy defines two EMA indicators, emaL and emaS, with periods of 100 and 20 respectively, and 3 update methods; In total, 5 update methods are available:</p><ul><li><code>onEnter</code> - called when no position is open</li><li><code>onUpdateLong</code> - called when a long position is open</li><li><code>onUpdateShort</code> - called when a short position is open</li><li><code>onUpdate</code> - called when any position is open</li><li><code>onPriceUpdate</code> - called on every tick</li></ul><h2 id="update-handlers"><a class="header-anchor" href="#update-handlers">§</a> Update Handlers</h2><p>All update handlers must be asynchronous, and receive an update json object which has the following fields:</p><ul><li><code>type</code> - ‘candle’ or ‘trade’, indicating which fields are available</li><li><code>mts</code> - Timestamp, in ms</li><li><code>price</code> - Candle or trade price (depends on candlePrice strategy setting) for candles, open, high, low, close, and vol are provided</li></ul><p>Strategy state is stored in the strategy object (<code>self</code>) and can be queried for historical candle data, indicators &amp; indicator values, open positions, and previous strategy trades. For an example, see the EMA cross example <code>onEnter</code> handler below.</p><pre><code class="hljs language-python"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">onEnter</span><span class="hljs-params">(self, update)</span>:</span>
  iv = self.indicatorValues()
  emaS = self.indicators[<span class="hljs-string">'emaS'</span>]

  s = iv[<span class="hljs-string">'emaS'</span>]
  l = iv[<span class="hljs-string">'emaL'</span>]
  <span class="hljs-keyword">if</span> emaS.crossed(l):
    <span class="hljs-keyword">if</span> s &gt; l:
      <span class="hljs-keyword">await</span> self.openLongPositionMarket(
        mtsCreate=update[<span class="hljs-string">'mts'</span>], price=update[<span class="hljs-string">'price'</span>], amount=<span class="hljs-number">0.1</span>)
    <span class="hljs-keyword">else</span>:
      <span class="hljs-keyword">await</span> self.openShortPositionMarket(
        mtsCreate=update[<span class="hljs-string">'mts'</span>], price=update[<span class="hljs-string">'price'</span>], amount=<span class="hljs-number">0.1</span>)

</code></pre><h2 id="managing-positions"><a class="header-anchor" href="#managing-positions">§</a> Managing positions</h2><p>The hfstrategy class exposes a bunch of asynchronous methods to help open/close/update any positions:</p><ul><li><code>open_long_position_market(*args, **kwargs)</code></li><li><code>open_long_position_limit(*args, **kwargs)</code></li><li><code>open_long_position(*args, **kwargs)</code></li><li><code>open_short_position_market(*args, **kwargs)</code></li><li><code>open_short_position_limit(*args, **kwargs)</code></li><li><code>open_short_position(*args, **kwargs)</code></li><li><code>open_position(*args, **kwargs)</code></li><li><code>update_long_position_market(*args, **kwargs)</code></li><li><code>update_long_position_limit(*args, **kwargs)</code></li><li><code>update_long_position(*args, **kwargs)</code></li><li><code>update_short_position_market(*args, **kwargs)</code></li><li><code>update_short_position_limit(*args, **kwargs)</code></li><li><code>update_short_position(*args, **kwargs)</code></li><li><code>update_position(*args, **kwargs)</code></li><li><code>close_position_market(*args, **kwargs)</code></li><li><code>close_position_limit(*args, **kwargs)</code></li><li><code>close_position(*args, **kwargs)</code> The price and mtsCreate timestamp must both be provided to all update handlers, even those operating with MARKET orders, in order to record the price and timestamp during backtests. If these are not provided, backtests run via bfx-hf-backtest will fail.</li></ul><h1 id="backtesting"><a class="header-anchor" href="#backtesting">§</a> Backtesting</h1><p>Honey frame work comes packed with 4 different executors which can be used to run backtests from various different sources of data and to also execute the strategy on the a live trading account. First we need to import and initialize the Executor class.</p><pre><code class="hljs language-python"><span class="hljs-keyword">from</span> hfstrategy <span class="hljs-keyword">import</span> Executor
exe = Executor(strategy)
</code></pre><h2 id="offline"><a class="header-anchor" href="#offline">§</a> Offline</h2><p>The offline executor accepts the file location of candle data that is store locally. It then begins to run the candle data through the strategy in the same way that the strategy would receive the data if it was running on live data.</p><pre><code class="hljs language-python">exe.offline(file=<span class="hljs-string">'btc_candle_data.json'</span>, tf=<span class="hljs-string">'1hr'</span>)
</code></pre><p>Once the executor has finishied it will display a matplotlib visualization of the orders/positions that the strategy created. The chart shows long orders as a green arrow, short orders as a red arrow and position closes as a blue dot. When using an executor that runs forever such as live or backtest_live, pressing CTR-C to kill the script will trigger the chart to render.</p><p><img src="https://i.ibb.co/47jL0xL/chart-pic.png" alt="alt text" title="Back-testing chart example"></p><h2 id="data-server"><a class="header-anchor" href="#data-server">§</a> Data server</h2><p>Alternatively you can connect the strategy to an instance of the <a href="https://github.com/bitfinexcom/bfx-hf-data-server">bfx-hf-data-server</a> which will allows you to specify the time period of the data that you would like to execute the strategy on. The data server will then begin to stream data for the given time period to your strategy.</p><pre><code class="hljs language-python"><span class="hljs-keyword">import</span> time
now = int(round(time.time() * <span class="hljs-number">1000</span>))
then = now - (<span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">5</span>) <span class="hljs-comment"># 5 days ago</span>
exe.with_data_server(then, now)
</code></pre><p>NOTE: this requires you to run an instance of the <code>bfx-hf-data-server</code> locally on port <code>8899</code></p><h2 id="live-backtesting"><a class="header-anchor" href="#live-backtesting">§</a> Live backtesting</h2><p>Live backtesting allows you to run the strategy with realtime data pulled from the Bitfinex api but with the order management still being simulated. We recommend that you use this method before running your strategy on a live account.</p><pre><code class="hljs language-python">exe.backtest_live()
</code></pre><h2 id="live-trading"><a class="header-anchor" href="#live-trading">§</a> Live trading</h2><p>Finally, once you have tested your strategy and are happy to begin making live trades you can run the strategy using the live executor. For this you will need your api key and secret from your Bitfinex account.</p><pre><code class="hljs language-python">API_KEY=<span class="hljs-string">"&lt;MY_API_KEY&gt;"</span>
API_SECRET=<span class="hljs-string">"&lt;MY_API_SECRET_KEY&gt;"</span>
exe.live(API_KEY, API_SECRET)
</code></pre><h1 id="examples"><a class="header-anchor" href="#examples">§</a> Examples</h1><p>For more info on how to use this framework please navigate to <code>/examples</code> where you will find 3 example strategies including an advanced implementation.</p></div></div><!--
      <div id="bfx-oss-docs-footer-bar">
        <div id="bfx-oss-docs-footer-bar__container">
          <p>Copyright © 2013-2020 iFinex Inc. All rights reserved.</p>
        </div>
      </div>
      --></div><script type="text/javascript" src="js/vendor/debug.min.js"></script><script type="text/javascript" src="js/vendor/lodash.min.js"></script><script type="text/javascript" src="js/vendor/zepto.min.js"></script><script type="text/javascript" src="js/vendor/perfect-scrollbar.min.js"></script><script type="text/javascript" src="js/main.js"></script></body></html>