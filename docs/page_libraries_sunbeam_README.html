<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width,initial-scale=1"><meta charset="utf-8"><link rel="stylesheet" type="text/css" href="css/normalize.css"><link rel="stylesheet" type="text/css" href="css/perfect-scrollbar.css"><link rel="stylesheet" type="text/css" href="css/highlightjs/night-owl.css"><link rel="stylesheet" type="text/css" href="index.css"><title>README | sunbeam</title></head><body><div id="bfx-oss-docs-side-bar"><div id="bfx-oss-docs-side-bar__header"><img src="img/bfx-logo-bg-white.png" alt="Bitfinex" height="63"></div><ul><li><a href="index.html"><p>Home</p></a></li><li><a href="page_md_render_test.html"><p>Markdown Render Test</p></a></li><li><a href="/page_libraries_bitfinex_api_py_README.html"><img src="/svg/icons/python.svg"><p>bitfinex-api-py</p></a></li><li><a href="/page_libraries_bitfinex_api_go_README.html"><img src="/svg/icons/go.svg"><p>bitfinex-api-go</p></a></li><li><a href="/page_libraries_bfxfixgw_README.html"><img src="/svg/icons/go.svg"><p>bfxfixgw</p></a></li><li><a href="/page_libraries_bitfinex_api_rb_README.html"><img src="/svg/icons/ruby.svg"><p>bitfinex-api-rb</p></a></li><li><a href="/page_libraries_bitfinex_api_node_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bitfinex-api-node</p></a></li><li><a href="/page_libraries_bfx_api_mock_srv_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-mock-srv</p></a></li><li><a href="/page_libraries_bfx_api_node_core_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-core</p></a></li><li><a href="/page_libraries_bfx_api_node_models_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-models</p></a></li><li><a href="/page_libraries_bfx_api_node_plugin_example_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-example</p></a></li><li><a href="/page_libraries_bfx_api_node_plugin_managed_candles_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-managed-candles</p></a></li><li><a href="/page_libraries_bfx_api_node_plugin_managed_ob_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-managed-ob</p></a></li><li><a href="/page_libraries_bfx_api_node_plugin_ob_checksum_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-ob-checksum</p></a></li><li><a href="/page_libraries_bfx_api_node_plugin_seq_audit_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-seq-audit</p></a></li><li><a href="/page_libraries_bfx_api_node_plugin_wd_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-wd</p></a></li><li><a href="/page_libraries_bfx_api_node_rest_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-rest</p></a></li><li><a href="/page_libraries_bfx_api_node_util_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-util</p></a></li><li><a href="/page_libraries_bfx_api_node_ws1_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-ws1</p></a></li><li><a href="/page_libraries_bfx_hf_backtest_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-backtest</p></a></li><li><a href="/page_libraries_bfx_hf_chart_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-chart</p></a></li><li><a href="/page_libraries_bfx_hf_data_server_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-data-server</p></a></li><li><a href="/page_libraries_bfx_hf_ext_plugin_bitfinex_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-ext-plugin-bitfinex</p></a></li><li><a href="/page_libraries_bfx_hf_ext_plugin_dummy_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-ext-plugin-dummy</p></a></li><li><a href="/page_libraries_bfx_hf_indicators_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-indicators</p></a></li><li><a href="/page_libraries_bfx_hf_models_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-models</p></a></li><li><a href="/page_libraries_bfx_hf_models_adapter_lowdb_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-lowdb</p></a></li><li><a href="/page_libraries_bfx_hf_models_adapter_sql_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-sql</p></a></li><li><a href="/page_libraries_bfx_hf_models_adapter_template_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-template</p></a></li><li><a href="/page_libraries_bfx_hf_algo_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-algo</p></a></li><li><a href="/page_libraries_bfx_hf_server_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-server</p></a></li><li><a href="/page_libraries_bfx_hf_strategy_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-strategy</p></a></li><li><a href="/page_libraries_bfx_hf_strategy_exec_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-strategy-exec</p></a></li><li><a href="/page_libraries_bfx_hf_ui_config_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-ui-config</p></a></li><li><a href="/page_libraries_bfx_hf_util_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-util</p></a></li><li><a href="/page_libraries_bfx_ws2_api_audit_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-ws2-api-audit</p></a></li><li><a href="/page_libraries_cbq_js_README.html"><img src="/svg/icons/nodejs_small.svg"><p>cbq-js</p></a></li><li><a href="/page_libraries_caron_README.html"><img src="/svg/icons/nodejs_small.svg"><p>caron</p></a></li><li><a href="/page_libraries_eos_name_verify_README.html"><img src="/svg/icons/nodejs_small.svg"><p>eos-name-verify</p></a></li><li><a href="/page_libraries_grenache_browser_http_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-browser-http</p></a></li><li><a href="/page_libraries_grenache_grape_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-grape</p></a></li><li><a href="/page_libraries_grenache_nodejs_base_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-nodejs-base</p></a></li><li><a href="/page_libraries_grenache_nodejs_http_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-nodejs-http</p></a></li><li><a href="/page_libraries_grenache_nodejs_link_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-nodejs-link</p></a></li><li><a href="/page_libraries_grenache_nodejs_utp_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-nodejs-utp</p></a></li><li><a href="/page_libraries_grenache_nodejs_ws_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-nodejs-ws</p></a></li><li><a href="/page_libraries_grenache_nodejs_ws_tls_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-nodejs-ws-tls</p></a></li><li><a href="/page_libraries_lib_js_util_currencies_README.html"><img src="/svg/icons/nodejs_small.svg"><p>lib-js-util-currencies</p></a></li><li><a href="/page_libraries_lib_js_util_math_README.html"><img src="/svg/icons/nodejs_small.svg"><p>lib-js-util-math</p></a></li><li><a href="/page_libraries_lib_js_util_number_README.html"><img src="/svg/icons/nodejs_small.svg"><p>lib-js-util-number</p></a></li><li><a href="/page_libraries_lib_js_util_symbol_README.html"><img src="/svg/icons/nodejs_small.svg"><p>lib-js-util-symbol</p></a></li><li><a href="/page_libraries_smidgen_README.html"><img src="/svg/icons/nodejs_small.svg"><p>smidgen</p></a></li><li class="active"><a href="/page_libraries_sunbeam_README.html"><img src="/svg/icons/nodejs_small.svg"><p>sunbeam</p></a><ul><li class="active"><a href="page_libraries_sunbeam_README.html"><p>- README</p></a></li><li><a href="page_libraries_sunbeam_reference.html"><p>- API Reference</p></a></li></ul></li><li><a href="/page_libraries_wasteland_README.html"><img src="/svg/icons/nodejs_small.svg"><p>wasteland</p></a></li></ul></div><div id="bfx-oss-docs-content"><div id="bfx-oss-docs-header-bar"><h2>README</h2><h2>sunbeam</h2></div><div id="bfx-oss-docs-content-wrapper" class="bfx-oss-docs-content-type-api-docs"><div class="bfx-oss-docs-md-content bfx-oss-docs-code-wrapper"><div id="bfx-oss-docs-api-docs-index"><div id="bfx-oss-docs-api-docs-index__inner"><nav class="bfx-oss-docs-md-toc"><ol><li><a href="#sunbeam">Sunbeam</a><ol><li><a href="#paper-trading">Paper Trading</a></li><li><a href="#examples">Examples</a><ol><li><a href="#node.js">Node.js</a></li></ol></li><li><a href="#websocket-api">Websocket API</a><ol><li><a href="#new-sunbeam(client%2C-opts)-%3D%3E-sunbeam">new Sunbeam(client, opts) =&gt; sunbeam</a></li><li><a href="#events-emitted">Events emitted</a><ol><li><a href="#event%3A-open">Event: open</a></li><li><a href="#event%3A-message">Event: message</a></li><li><a href="#event%3A-error">Event: error</a></li></ol></li><li><a href="#general-methods">General methods</a><ol><li><a href="#sunbeam.open()">sunbeam.open()</a></li><li><a href="#sunbeam.close()">sunbeam.close()</a></li><li><a href="#sunbeam.auth()-%3D%3E-promise">sunbeam.auth() =&gt; Promise</a></li><li><a href="#sunbeam.accepttos(version)">sunbeam.acceptTos(version)</a></li><li><a href="#sunbeam.getsignedtx(%3Fuser)-%3D%3E-promise">sunbeam.getSignedTx(?user) =&gt; Promise</a></li><li><a href="#sunbeam.logoutscatter()-%3D%3E-promise">sunbeam.logoutScatter() =&gt; Promise</a></li><li><a href="#sunbeam.place(order)-%3D%3E-promise">sunbeam.place(order) =&gt; Promise</a><ol><li><a href="#list-of-available-flags">List of available flags</a></li></ol></li><li><a href="#sunbeam.cancel(data)-%3D%3E-promise">sunbeam.cancel(data) =&gt; Promise</a></li><li><a href="#sunbeam.withdraw(data)-%3D%3E-promise">sunbeam.withdraw(data) =&gt; Promise</a></li><li><a href="#sunbeam.sweep(data)-%3D%3E-promise">sunbeam.sweep(data) =&gt; Promise</a></li><li><a href="#sunbeam.deposit(data)-%3D%3E-promise">sunbeam.deposit(data) =&gt; Promise</a></li><li><a href="#sunbeam.subscribeorderbook(pair)">sunbeam.subscribeOrderbook(pair)</a></li><li><a href="#sunbeam.subscribepublictrades(pair)">sunbeam.subscribePublicTrades(pair)</a></li><li><a href="#sunbeam.unsubscribeorderbook(pair)">sunbeam.unsubscribeOrderbook(pair)</a></li><li><a href="#sunbeam.subscribe(transport%2C-channel%2C-%3Fopts)">sunbeam.subscribe(transport, channel, ?opts)</a></li><li><a href="#sunbeam.unsubscribe(transport%2C-channel%2C-%3Fopts)">sunbeam.unsubscribe(transport, channel, ?opts)</a></li><li><a href="#websocket-api-helper-rpc-calls">Websocket API helper RPC calls</a><ol><li><a href="#chain-metadata---%7B-event%3A-%E2%80%98chain%E2%80%99-%7D">Chain metadata - { event: ‘chain’ }</a></li><li><a href="#trading-pairs---%7B-event%3A-%E2%80%98pa%E2%80%99-%7D">Trading pairs - { event: ‘pa’ }</a></li></ol></li></ol></li><li><a href="#managed-state-updates">Managed State Updates</a><ol><li><a href="#sunbeam.onmanagedorderbook(opts%2C-handler)">sunbeam.onManagedOrderbook(opts, handler)</a></li><li><a href="#sunbeam.onmanagedwallet(opts%2C-handler)">sunbeam.onManagedWallet(opts, handler)</a></li><li><a href="#sunbeam.onmanagedorders(filter%2C-handler)">sunbeam.onManagedOrders(filter, handler)</a></li></ol></li><li><a href="#plain-updates">Plain updates</a><ol><li><a href="#sunbeam.onwallet(opts%2C-handler)">sunbeam.onWallet(opts, handler)</a></li><li><a href="#sunbeam.onorders(opts%2C-handler)">sunbeam.onOrders(opts, handler)</a></li><li><a href="#sunbeam.onprivatetrades(opts%2C-handler)">sunbeam.onPrivateTrades(opts, handler)</a></li><li><a href="#sunbeam.onpublictrades(opts%2C-handler)">sunbeam.onPublicTrades(opts, handler)</a></li><li><a href="#sunbeam.onorderbook(opts%2C-handler)">sunbeam.onOrderbook(opts, handler)</a></li></ol></li></ol></li><li><a href="#standalone-managed-state-helper">Standalone Managed State Helper</a></li><li><a href="#setup-your-node">Setup your node</a><ol><li><a href="#browsers">Browsers</a></li></ol></li></ol></li></ol></nav></div></div><p><a href="https://travis-ci.org/bitfinexcom/sunbeam"><img src="https://travis-ci.org/bitfinexcom/sunbeam.svg?branch=master" alt="Build Status"></a></p><h1 id="sunbeam"><a class="header-anchor" href="#sunbeam">§</a> Sunbeam</h1><p>eosfinex Websocket adapter for Node and the browser.</p><p>We designed the eosfinex Websocket API with both speed and compatibility in mind. It is a subset of the existing Bitfinex API v2, with modifications for on-chain trading. Existing API v2 users should be able to start with only a small changeset to their existing clients.</p><p>Sunbeam is the current reference implementation of the Websocket API client. It interacts with the contract ABI. For more details, see the <a href="#signing">signing section</a>.</p><p>This readme covers both the Sunbeam API and explains how it interacts behind the scenes with the server.</p><p>The main difference between the Bitfinex WS API and eosfinex’s API is the signing of messages. For eosfinex, we have to sign actions with our eosjs private key. A signed transaction is also used for subscriptions to trade, order and wallet snapshots and updates.</p><pre><code class="hljs language-js"><span class="hljs-keyword">const</span> Sunbeam = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sunbeam'</span>)

<span class="hljs-comment">// Browser usage: import into browsers in case you can't transpile ES6</span>
<span class="hljs-keyword">const</span> Sunbeam = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sunbeam/dist'</span>)
</code></pre><h2 id="paper-trading"><a class="header-anchor" href="#paper-trading">§</a> Paper Trading</h2><p>On paper trading tokens are generally prefixed by <code>P</code>. So <code>USDT</code> becomes <code>PUSDT</code>. The only exception is the resource token <code>EOX</code>. For a list of available trading pairs, see <a href="#trade-pairs">#trade-pairs</a>.</p><h2 id="examples"><a class="header-anchor" href="#examples">§</a> Examples</h2><h3 id="node.js"><a class="header-anchor" href="#node.js">§</a> Node.js</h3><p>Example of the Websocket client usage: <a href="example-ws.js">example-ws.js</a></p><p>Run with:</p><pre><code class="hljs"><span class="hljs-keyword">node</span> <span class="hljs-title">example-ws</span>.js
</code></pre><h2 id="websocket-api"><a class="header-anchor" href="#websocket-api">§</a> Websocket API</h2><p>You can see all API calls in <a href="example-ws.js">example-ws.js</a>.</p><h3 id="new-sunbeam(client%2C-opts)-%3D%3E-sunbeam"><a class="header-anchor" href="#new-sunbeam(client%2C-opts)-%3D%3E-sunbeam">§</a> <code>new Sunbeam(client, opts) =&gt; sunbeam</code></h3><ul><li><code>client &lt;Object&gt;</code><ul><li><code>rpc</code> official eosjs rpc class instance</li><li><code>api</code> official eosjs Api class instance</li></ul></li><li><code>opts &lt;Object&gt;</code><ul><li><code>urls &lt;Object&gt;</code> Websocket transports<ul><li><code>pub &lt;String&gt;</code> Public transport</li><li><code>priv &lt;String&gt;</code>Private transport</li><li><code>aux &lt;String&gt;</code> Aux transport</li></ul></li><li><code>eos &lt;Object&gt;</code> options passed to Eos client for signing transactions<ul><li><code>expireInSeconds &lt;Number&gt;</code> Expiration time for signed tx</li><li><code>httpEndpoint &lt;String|null&gt;</code> an Eos node HTTP endpoint, used to get the contract abi, if abi not passed via options.</li><li><code>tokenContract &lt;String|null&gt;</code> name of the used token contract, defaults to <code>eosio.token</code></li><li><code>exchangeContract &lt;String|null&gt;</code> name of the used exchange contract, defaults to <code>efinexchange</code></li><li><code>auth</code> Auth options<ul><li><code>keys</code> use default signing<ul><li><code>keyProvider &lt;String&gt;</code> your key, used to sign transactions</li><li><code>account &lt;String&gt;</code> accountname to use for the key</li><li><code>permission &lt;String&gt;</code> permission level to use for the account</li></ul></li><li><code>scatter &lt;Object&gt;</code> Scatter options if scatter is used for signing<ul><li><code>appName &lt;String&gt;</code> App name showed to Scatter user</li><li><code>ScatterJS &lt;Object&gt;</code> Scatter instance</li></ul></li></ul></li></ul></li><li><code>state &lt;Object&gt;</code> Options passed to state components<ul><li><code>transform &lt;Object&gt;</code> transformation ooptions (keyed objects or array format)<ul><li><code>orderbook &lt;Object&gt;</code><ul><li><code>keyed &lt;Boolean&gt;</code> Manage state as keyed Objects instead of an Array</li></ul></li><li><code>wallet &lt;Object&gt;</code></li><li><code>orders &lt;Object&gt;</code><ul><li><code>keyed &lt;Boolean&gt;</code> Manage state as keyed Objects instead of an Array</li><li><code>markDeleted &lt;Boolean&gt;</code> cancelled orders are flagged as deleted, but not removed from the state</li></ul></li></ul></li></ul></li></ul></li></ul><pre><code class="hljs language-js"><span class="hljs-comment">// prepare eosjs lib for signing of websocket messages</span>

<span class="hljs-keyword">const</span> { Api, JsonRpc } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'eosjs'</span>)
<span class="hljs-keyword">const</span> { JsSignatureProvider } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'eosjs/dist/eosjs-jssig'</span>)


<span class="hljs-keyword">const</span> fetch = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node-fetch'</span>)
<span class="hljs-keyword">const</span> { TextDecoder, TextEncoder } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>)
<span class="hljs-keyword">const</span> keys = [<span class="hljs-string">'SECRET'</span>]

<span class="hljs-keyword">const</span> signatureProvider = <span class="hljs-keyword">new</span> JsSignatureProvider(keys)

<span class="hljs-keyword">const</span> httpEndpoint = <span class="hljs-string">'https://api-paper.eosfinex.com'</span>

<span class="hljs-keyword">const</span> rpc = <span class="hljs-keyword">new</span> JsonRpc(httpEndpoint, { fetch })
<span class="hljs-keyword">const</span> api = <span class="hljs-keyword">new</span> Api({
  rpc,
  signatureProvider,
  <span class="hljs-attr">textDecoder</span>: <span class="hljs-keyword">new</span> TextDecoder(),
  <span class="hljs-attr">textEncoder</span>: <span class="hljs-keyword">new</span> TextEncoder()
})

<span class="hljs-keyword">const</span> client = {
  rpc,
  api
}

<span class="hljs-comment">// setup sunbeam</span>
<span class="hljs-keyword">const</span> opts = {
  <span class="hljs-attr">url</span>: <span class="hljs-string">'wss://api-paper.eosfinex.com/ws/'</span>,
  <span class="hljs-attr">eos</span>: {
    <span class="hljs-attr">expireInSeconds</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span>, <span class="hljs-comment">// 1 hour,</span>
    <span class="hljs-attr">httpEndpoint</span>: httpEndpoint, <span class="hljs-comment">// used to get metadata for signing transactions</span>
    <span class="hljs-attr">tokenContract</span>: <span class="hljs-string">'eosio.token'</span>, <span class="hljs-comment">// Prod sidechain token contract</span>
    <span class="hljs-attr">exchangeContract</span>: <span class="hljs-string">'eosfinex'</span>, <span class="hljs-comment">// Prod sidechain exchange contract</span>
    <span class="hljs-attr">auth</span>: {
      <span class="hljs-attr">keys</span>: {
        <span class="hljs-attr">account</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// accountname to use</span>
        <span class="hljs-attr">permission</span>: <span class="hljs-string">'active'</span>
      },
      <span class="hljs-attr">scatter</span>: <span class="hljs-literal">null</span>
    }
  },
  <span class="hljs-attr">state</span>: {
    <span class="hljs-attr">transform</span>: {
      <span class="hljs-attr">orderbook</span>: { <span class="hljs-attr">keyed</span>: <span class="hljs-literal">true</span> },
      <span class="hljs-attr">wallet</span>: {},
      <span class="hljs-attr">orders</span>: {}
    }
  }
}

<span class="hljs-keyword">const</span> ws = <span class="hljs-keyword">new</span> Sunbeam(client, opts)

<span class="hljs-comment">// it is required to have read and agreed to our TOS to do trading</span>
<span class="hljs-comment">// get the current TOS version from:</span>
<span class="hljs-comment">// after reading the TOS, you can find them at the bottom of the page</span>
<span class="hljs-comment">// https://www.eosfinex.com/legal/terms/</span>
ws.on(<span class="hljs-string">'open'</span>, () =&gt; {
  <span class="hljs-keyword">const</span> tos = <span class="hljs-string">'$CURRENT_TOS'</span>
  ws.acceptTos(tos)
})

ws.open()
</code></pre><p>For an example how to use Scatter for auth, see <a href="example-scatter.js">example-scatter.js</a>.</p><h3 id="events-emitted"><a class="header-anchor" href="#events-emitted">§</a> Events emitted</h3><h4 id="event%3A-open"><a class="header-anchor" href="#event%3A-open">§</a> <code>Event: open</code></h4><p>Emitted when the socket connection is established.</p><p><em>Example:</em></p><pre><code class="hljs language-js"><span class="hljs-keyword">const</span> ws = <span class="hljs-keyword">new</span> Sunbeam(opts)

ws.on(<span class="hljs-string">'open'</span>, () =&gt; {
  <span class="hljs-comment">// ready to trade!</span>
})

ws.open()
</code></pre><h4 id="event%3A-message"><a class="header-anchor" href="#event%3A-message">§</a> <code>Event: message</code></h4><p>Emitted for every message that the Websocket client receives. Useful for debugging and custom extensions.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.on(<span class="hljs-string">'message'</span>, (m) =&gt; {
  <span class="hljs-built_in">console</span>.log(m)
})
</code></pre><h4 id="event%3A-error"><a class="header-anchor" href="#event%3A-error">§</a> <code>Event: error</code></h4><p>Emitted in case of an error.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.on(<span class="hljs-string">'error'</span>, (m) =&gt; {
  <span class="hljs-built_in">console</span>.error(m)
})
</code></pre><h3 id="general-methods"><a class="header-anchor" href="#general-methods">§</a> General methods</h3><p>You can see all API calls in <a href="example-ws.js">example-ws.js</a>. Before you can run it, make sure to configure your environment:</p><pre><code class="hljs language-sh">cp config/example-ws.config.json.example config/example-ws.config.json

vim config/example-ws.config.json
</code></pre><h4 id="sunbeam.open()"><a class="header-anchor" href="#sunbeam.open()">§</a> <code>sunbeam.open()</code></h4><p>Opens a Websocket.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.open()
</code></pre><h4 id="sunbeam.close()"><a class="header-anchor" href="#sunbeam.close()">§</a> <code>sunbeam.close()</code></h4><p>Closes the connection to the server.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.close()
</code></pre><h4 id="sunbeam.auth()-%3D%3E-promise"><a class="header-anchor" href="#sunbeam.auth()-%3D%3E-promise">§</a> <code>sunbeam.auth() =&gt; Promise</code></h4><p>Subscribes you to <code>wallet</code>, <code>trade</code> and <code>order</code> updates for the specified account.</p><p>Takes the account name you have defined when creating a Sunbeam instance with <code>opts.eos.auth</code> or receives the account name from Scatter. Your private key stays on your machine.</p><a id="auth"><p>You can authenticate on the eosfinex Websocket API like with the Bitfinex API. The API will then send you your wallet, order and trades snapshots and updates. For this a special action is available in the contract ABI called <code>validate</code>. The Websocket plugin uses it to verify that the transaction belongs to the proper account.</p><p>Sunbeam signs a verification transaction that is send to the Websocket endpoint for validation. This transaction is just used for verifying the signature.</p><p>If you configured auth via scatter, it will connect to scatter. Remember to remove any global references to ScatterJS <strong>and any global references to Sunbeam</strong>:</p><pre><code class="hljs language-js"><span class="hljs-built_in">window</span>.ScatterJS = <span class="hljs-literal">null</span>;
</code></pre><p><em>Sent payload:</em></p><pre><code class="hljs">{
 <span class="hljs-attribute">event</span>: <span class="hljs-string">'auth'</span>,
 account: <span class="hljs-string">'$YOUR_USERNAME'</span>,
 meta: signed
}
</code></pre><p>Where <code>signed</code> is a signed transaction for the <code>validate</code> action.</p><p><em>important:</em> to be able to trade, you have to accept the terms of service.</p><h4 id="sunbeam.accepttos(version)"><a class="header-anchor" href="#sunbeam.accepttos(version)">§</a> <code>sunbeam.acceptTos(version)</code></h4><p>Accepts the terms of service. Must be called before <code>.auth()</code></p><p>It is required to have read and agreed to our TOS to do trading After reading the TOS, you can find the current version at the bottom of the page <a href="https://www.eosfinex.com/legal/terms/">https://www.eosfinex.com/legal/terms/</a></p><h4 id="sunbeam.getsignedtx(%3Fuser)-%3D%3E-promise"><a class="header-anchor" href="#sunbeam.getsignedtx(%3Fuser)-%3D%3E-promise">§</a> <code>sunbeam.getSignedTx(?user) =&gt; Promise</code></h4><ul><li><code>user &lt;Object&gt;</code> optional user object. if not defined, will use the data provided in the constructor or retrieve it from scatter</li></ul><p>Signs a transaction that can be used for login on the WS server for custom auth flows.</p><p>Example:</p><pre><code class="hljs language-js"><span class="hljs-keyword">const</span> user = {
  <span class="hljs-attr">authorization</span>: {
    <span class="hljs-attr">authorization</span>: <span class="hljs-string">"testuser1114@active"</span>
  },
  <span class="hljs-attr">account</span>: <span class="hljs-string">"testuser1114"</span>,
  <span class="hljs-attr">permission</span>: <span class="hljs-string">"active"</span>
}

<span class="hljs-keyword">const</span> signed = <span class="hljs-keyword">await</span> ws.getSignedTx(user)

<span class="hljs-keyword">const</span> getData = <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify(data),
    <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> }
  }
}

<span class="hljs-comment">// get history</span>
<span class="hljs-keyword">const</span> history = <span class="hljs-keyword">await</span> fetch(moonbeamUrl + <span class="hljs-string">'/history'</span>, getData({
  <span class="hljs-attr">meta</span>: signed,
  <span class="hljs-attr">limit</span>: <span class="hljs-number">50</span>
})).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json())

<span class="hljs-built_in">console</span>.log(history)
</code></pre><h4 id="sunbeam.logoutscatter()-%3D%3E-promise"><a class="header-anchor" href="#sunbeam.logoutscatter()-%3D%3E-promise">§</a> <code>sunbeam.logoutScatter() =&gt; Promise</code></h4><p>Forgets scatter identity (if scatter is used for auth).</p><h4 id="sunbeam.place(order)-%3D%3E-promise"><a class="header-anchor" href="#sunbeam.place(order)-%3D%3E-promise">§</a> <code>sunbeam.place(order) =&gt; Promise</code></h4><ul><li><code>order &lt;Object&gt;</code><ul><li><code>symbol &lt;String&gt;</code> Token pair to trade for</li><li><code>amount &lt;String&gt;</code> Amount to buy/sell</li><li><code>type &lt;String&gt;</code> Order type, <code>EXCHANGE_MARKET</code>, <code>EXCHANGE_IOC</code> or <code>EXCHANGE_LIMIT</code></li><li><code>price &lt;String&gt;</code> Price for orders except market orders</li><li><code>clientId &lt;Number&gt;</code> Every order must have a unique id assigned from the client, defaults to unix timestamp</li><li><code>postOnly &lt;Boolean&gt;</code> Submit postonly order, sugar for flags <code>1</code></li><li><code>flags &lt;Number&gt;</code></li></ul></li></ul><p>Creates an order compatible with the contract ABI, pre-signs it and sends it to the Websocket endpoint.</p><p>To be able to identify the order, a client <strong>MUST</strong> send a custom client id with it that must be unique to the clients orders.</p><h5 id="list-of-available-flags"><a class="header-anchor" href="#list-of-available-flags">§</a> List of available flags</h5><a id="order-flags"><p>Some flags are abstracted by Sunbeam. Here is a full list of available flags:</p><pre><code class="hljs"><span class="hljs-string">type</span>                         <span class="hljs-string">flag</span>         <span class="hljs-string">abstraction</span> <span class="hljs-string">available</span>

<span class="hljs-attr">post only                       1         postOnly:</span> <span class="hljs-literal">true</span>
<span class="hljs-string">ioc</span>                             <span class="hljs-number">2</span>         <span class="hljs-string">EXCHANGE_IOC</span>
<span class="hljs-string">market</span>                          <span class="hljs-number">4</span>         <span class="hljs-string">EXCHANGE_MARKET</span>
<span class="hljs-string">release</span> <span class="hljs-string">on</span> <span class="hljs-string">trade</span>               <span class="hljs-number">64</span>
<span class="hljs-string">sweep</span> <span class="hljs-string">collateral</span>              <span class="hljs-number">128</span>

</code></pre><p>A post only order would have the flag 1, A post only + IOC order would have the flag 3</p><a id="signing"><a id="abi"><p>Behind the scenes Sunbeam uses the exchange contract ABI to sign the transaction. The ABI is publicly available via <code>cleos</code> or curl:</p><pre><code class="hljs"><span class="hljs-string">curl </span><span class="hljs-built_in">--request</span> <span class="hljs-string">POST </span>\
  <span class="hljs-built_in">--url</span> <span class="hljs-string">https:</span>//<span class="hljs-string">api.</span><span class="hljs-string">eosfinex.</span><span class="hljs-string">com/</span><span class="hljs-string">v1/</span><span class="hljs-string">chain/</span><span class="hljs-string">get_abi </span>\
  <span class="hljs-built_in">--header</span> <span class="hljs-string">'accept: application/json'</span> \
  <span class="hljs-built_in">--header</span> <span class="hljs-string">'content-type: application/json'</span> \
  <span class="hljs-built_in">--data</span> <span class="hljs-string">'{"account_name":"eosfinex"}'</span>
</code></pre><p>For an introduction to the contract ABI, see <a href="https://medium.com/eosfinexproject/the-eosfinex-exchange-contract-9c971c1aed1b">https://medium.com/eosfinexproject/the-eosfinex-exchange-contract-9c971c1aed1b</a></p><p>After signing, the transaction is sent to the Websocket server:</p><pre><code class="hljs language-js"><span class="hljs-keyword">const</span> signed = {
  <span class="hljs-string">"expiration"</span>: <span class="hljs-string">"2019-05-10T18:17:13.000"</span>,
  <span class="hljs-string">"ref_block_num"</span>: <span class="hljs-number">27684</span>,
  <span class="hljs-string">"ref_block_prefix"</span>: <span class="hljs-number">959416581</span>,
  <span class="hljs-string">"max_net_usage_words"</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">"max_cpu_usage_ms"</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">"delay_sec"</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">"context_free_actions"</span>: [],
  <span class="hljs-string">"actions"</span>: [
    {
      <span class="hljs-string">"account"</span>: <span class="hljs-string">"efinexchange"</span>,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"place"</span>,
      <span class="hljs-string">"authorization"</span>: [
        {
          <span class="hljs-string">"actor"</span>: <span class="hljs-string">"testuser1114"</span>,
          <span class="hljs-string">"permission"</span>: <span class="hljs-string">"active"</span>
        }
      ],
      <span class="hljs-string">"data"</span>: <span class="hljs-string">"40420857619DB1CAF1B4BFA26A01000000800139610D3A5548DA2D0000000000942A00000000000000"</span>
    }
  ],
  <span class="hljs-string">"transaction_extensions"</span>: [],
  <span class="hljs-string">"signatures"</span>: [
    <span class="hljs-string">"SIG_K1_Ke541LARCg24Zg66cacNLEfrJXJzfdgeZKNmyKEsxyGUVFxxEPxqJqYQJgv8gc2CXsG9a5HYvDrMePUGyfH8P6uihDoiSp"</span>
  ]
}

<span class="hljs-comment">// sent payload to server:</span>
[<span class="hljs-number">0</span>, <span class="hljs-string">'on'</span>, <span class="hljs-literal">null</span>, { <span class="hljs-attr">meta</span>: signed }]
</code></pre><p><em>Example:</em></p><pre><code class="hljs language-js">
<span class="hljs-comment">// available types: EXCHANGE_MARKET EXCHANGE_IOC EXCHANGE_LIMIT</span>
<span class="hljs-keyword">const</span> order = {
  <span class="hljs-attr">symbol</span>: <span class="hljs-string">'EOX.USDT'</span>,
  <span class="hljs-attr">amount</span>: <span class="hljs-string">'1'</span>,
  <span class="hljs-attr">type</span>: <span class="hljs-string">'EXCHANGE_MARKET'</span>,
  <span class="hljs-attr">clientId</span>: <span class="hljs-string">'12345'</span> <span class="hljs-comment">// unique locally assigned id</span>
}
ws.place(order)

<span class="hljs-comment">// available types: EXCHANGE_MARKET EXCHANGE_IOC EXCHANGE_LIMIT</span>
<span class="hljs-keyword">const</span> order = {
  <span class="hljs-attr">symbol</span>: <span class="hljs-string">'EOX.USDT'</span>,
  <span class="hljs-attr">amount</span>: <span class="hljs-string">'1'</span>,
  <span class="hljs-attr">price</span>: <span class="hljs-string">'1'</span>,
  <span class="hljs-attr">type</span>: <span class="hljs-string">'EXCHANGE_LIMIT'</span>,
  <span class="hljs-attr">clientId</span>: <span class="hljs-string">'12346'</span>
}
ws.place(order)
</code></pre><p>The request will be signed locally using the <code>eosjs</code> module.</p><p><em>Sent payload:</em></p><pre><code class="hljs">[<span class="hljs-name">0</span>, <span class="hljs-symbol">'on</span>', null, { meta: signed }]
</code></pre><p><code>signed</code> is a signed payload for the <code>place</code> <a href="#abi">action of the <strong>exchange contract</strong></a>.</p><h4 id="sunbeam.cancel(data)-%3D%3E-promise"><a class="header-anchor" href="#sunbeam.cancel(data)-%3D%3E-promise">§</a> <code>sunbeam.cancel(data) =&gt; Promise</code></h4><ul><li><code>data</code><ul><li><code>symbol &lt;String&gt;</code> The pair, i.e. <code>EOX.USDT</code></li><li><code>side &lt;String&gt;</code> <code>bid</code> or <code>ask</code></li><li><code>id &lt;String&gt;</code> The id returned from the contract on placement</li><li><code>clientId &lt;String&gt;</code> The unique id assigned by the client</li></ul></li></ul><p>Cancels an order.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.cancel({
  <span class="hljs-attr">symbol</span>: <span class="hljs-string">'EOX.USDT'</span>,
  <span class="hljs-attr">side</span>: <span class="hljs-string">'bid'</span>,
  <span class="hljs-attr">id</span>: <span class="hljs-string">'18446744073709551612'</span>,
  <span class="hljs-attr">clientId</span>: <span class="hljs-string">'1536867193329'</span>
})
</code></pre><p>The request will be <a href="#signing">signed locally</a> using the <code>eosjs</code> module.</p><p><em>Sent payload:</em></p><pre><code class="hljs">[<span class="hljs-name">0</span>, <span class="hljs-symbol">'oc</span>', null, { meta: signed }]
</code></pre><p><code>signed</code> is a signed payload for the <code>cancel</code> <a href="#abi">action of the <strong>exchange contract</strong></a>.</p><h4 id="sunbeam.withdraw(data)-%3D%3E-promise"><a class="header-anchor" href="#sunbeam.withdraw(data)-%3D%3E-promise">§</a> <code>sunbeam.withdraw(data) =&gt; Promise</code></h4><ul><li><code>data</code><ul><li><code>currency &lt;String&gt;</code> The currency to withdraw, e.g. <code>BTC</code></li><li><code>amount &lt;String&gt;</code> The amount to withdraw</li><li><code>to &lt;String&gt; (optional)</code> The account to withdraw to.</li></ul></li></ul><p>Withdraws tokens to a specified account. The account must be the same as the account used with eosfinex.</p><p>Defaults to the account used for auth.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.withdraw({
  <span class="hljs-attr">currency</span>: <span class="hljs-string">'EUR'</span>,
  <span class="hljs-attr">amount</span>: <span class="hljs-string">'0.678'</span>
})
</code></pre><p>The request will be <a href="#signing">signed locally</a> using the <code>eosjs</code> module.</p><p><em>Sent payload:</em></p><pre><code class="hljs">[<span class="hljs-name">0</span>, <span class="hljs-symbol">'tx</span>', null, { meta: signed }]
</code></pre><p>This request uses the general <code>tx</code> identifier for messages. <code>signed</code> is a signed payload for the <code>withdraw</code> <a href="#abi">action of the <strong>exchange contract</strong></a>.</p><h4 id="sunbeam.sweep(data)-%3D%3E-promise"><a class="header-anchor" href="#sunbeam.sweep(data)-%3D%3E-promise">§</a> <code>sunbeam.sweep(data) =&gt; Promise</code></h4><ul><li><code>data</code><ul><li><code>currency &lt;String&gt;</code> The currency to withdraw, e.g. <code>BTC</code></li><li><code>to &lt;String&gt; (optional)</code> The account to withdraw to.</li></ul></li></ul><p>Sweeps tokens to a specified account. The account must be the same as the account used with eosfinex.</p><p>Defaults to the account used for auth.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.sweep({
  <span class="hljs-attr">currency</span>: <span class="hljs-string">'EUR'</span>
})

<span class="hljs-comment">// on success we receive a wallet update:</span>
<span class="hljs-comment">// [ '0', 'wu', [ 'exchange', 'EUR', 0, 0, null ] ]</span>

<span class="hljs-comment">// and the amount is transferred back to the deposit contract:</span>
<span class="hljs-comment">// $ ./cleos get currency balance efinextether testuser1431</span>
<span class="hljs-comment">// 100.00000000 EUR</span>
</code></pre><p><em>Sent payload:</em></p><pre><code class="hljs">[<span class="hljs-name">0</span>, <span class="hljs-symbol">'tx</span>', null, { meta: signed }]
</code></pre><p>This request uses the general <code>tx</code> identifier for messages. <code>signed</code> is a signed payload for the <code>sweep</code> <a href="#abi">action of the <strong>exchange contract</strong></a>.</p><h4 id="sunbeam.deposit(data)-%3D%3E-promise"><a class="header-anchor" href="#sunbeam.deposit(data)-%3D%3E-promise">§</a> <code>sunbeam.deposit(data) =&gt; Promise</code></h4><ul><li><code>data</code><ul><li><code>currency &lt;String&gt;</code> The currency to deposit, e.g. <code>BTC</code></li><li><code>amount &lt;String&gt;</code> The amount to deposit</li></ul></li></ul><p>Deposits the desired amount to the exchange using the <strong>token contract</strong>. Takes the user account used for auth.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.deposit({
  <span class="hljs-attr">currency</span>: <span class="hljs-string">'EUR'</span>,
  <span class="hljs-attr">amount</span>: <span class="hljs-string">'2'</span>
})

<span class="hljs-comment">// success:</span>
<span class="hljs-comment">// [ '0', 'wu', [ 'exchange', 'EUR', 2, 0, null ] ]</span>
</code></pre><p><em>Sent payload:</em></p><pre><code class="hljs">[<span class="hljs-name">0</span>, <span class="hljs-symbol">'tx</span>', null, { meta: signed }]
</code></pre><p>This request uses the general <code>tx</code> identifier for messages. <code>signed</code> is a signed payload for the <code>sweep</code> action of the <strong>token contract</strong>.</p><p>The request will be <a href="#signing">signed locally</a> using the <code>eosjs</code> module.</p><h4 id="sunbeam.subscribeorderbook(pair)"><a class="header-anchor" href="#sunbeam.subscribeorderbook(pair)">§</a> <code>sunbeam.subscribeOrderbook(pair)</code></h4><ul><li><code>pair &lt;String&gt;</code> The pair, i.e. <code>EOX.USDT</code></li></ul><p>Subscribe to orderbook updates for a pair. The format is <code>R0</code>: <a href="https://docs.bitfinex.com/v2/reference#ws-public-raw-order-books">https://docs.bitfinex.com/v2/reference#ws-public-raw-order-books</a> The amount of entries is limited to 100 entries on the bid and ask side.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.onOrderbook({ <span class="hljs-attr">symbol</span>: <span class="hljs-string">'EOX.USDT'</span> }, (ob) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ws.onOrderbook({ symbol: "EOX.USDT" }'</span>)
  <span class="hljs-built_in">console</span>.log(ob)
})

ws.onManagedOrderbook({ <span class="hljs-attr">symbol</span>: <span class="hljs-string">'EOX.USDT'</span> }, (ob) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ws.onManagedOrderbook({ symbol: "EOX.USDT" }'</span>)
  <span class="hljs-built_in">console</span>.log(ob)
})

<span class="hljs-comment">// subscribe via:</span>
<span class="hljs-comment">// { event: 'subscribe', channel: 'book', symbol: 'EOX.USDT' }</span>
ws.subscribeOrderbook(<span class="hljs-string">'EOX.USDT'</span>)
</code></pre><p><em>Sent Payload:</em></p><pre><code class="hljs">{ <span class="hljs-attribute">event</span>: <span class="hljs-string">'subscribe'</span>, channel: <span class="hljs-string">'book'</span>, symbol: <span class="hljs-string">'EOX.USDT'</span> }
</code></pre><p><em>Example responses:</em></p><pre><code class="hljs"><span class="hljs-comment">// format</span>
[<span class="hljs-meta">PAIR,[ID,AMOUNT,PRICE</span>], TIMESTAMP]

<span class="hljs-comment">// snapshot:</span>
[<span class="hljs-meta"><span class="hljs-meta-string">"EOS.USDT"</span>,[<span class="hljs-meta-string">"263237"</span>,4.0921,-1.8913</span>], <span class="hljs-number">1565682279501</span>]]

<span class="hljs-comment">// update:</span>
[<span class="hljs-meta"><span class="hljs-meta-string">"EOS.USDT"</span>,[<span class="hljs-meta-string">"263237"</span>,4.0921,-1.8913</span>], <span class="hljs-number">1565682279520</span>]
</code></pre><h4 id="sunbeam.subscribepublictrades(pair)"><a class="header-anchor" href="#sunbeam.subscribepublictrades(pair)">§</a> <code>sunbeam.subscribePublicTrades(pair)</code></h4><ul><li><code>pair &lt;String&gt;</code> The pair, i.e. <code>EOX.USDT</code></li></ul><p>Unsubscribe from public trade updates for a pair.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.subscribePublicTrades(<span class="hljs-string">'EOX.USDT'</span>)
</code></pre><p><em>Sent Payload:</em></p><pre><code class="hljs">{ <span class="hljs-attribute">event</span>: <span class="hljs-string">'subscribe'</span>, channel: <span class="hljs-string">'trades'</span>, symbol: <span class="hljs-string">'EOX.USDT'</span> }
</code></pre><h4 id="sunbeam.unsubscribeorderbook(pair)"><a class="header-anchor" href="#sunbeam.unsubscribeorderbook(pair)">§</a> <code>sunbeam.unsubscribeOrderbook(pair)</code></h4><ul><li><code>pair &lt;String&gt;</code> The pair, i.e. <code>EOX.USDT</code></li></ul><p>Unsubscribe from orderbook updates for a pair.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.unsubscribeOrderbook(<span class="hljs-string">'EOX.USDT'</span>)
</code></pre><p><em>Sent Payload:</em></p><pre><code class="hljs">{
  <span class="hljs-attribute">event</span>: <span class="hljs-string">'unsubscribe'</span>,
  channel: <span class="hljs-string">'book'</span>,
  symbol: <span class="hljs-string">'EOX.USDT'</span>
}
</code></pre><h4 id="sunbeam.subscribe(transport%2C-channel%2C-%3Fopts)"><a class="header-anchor" href="#sunbeam.subscribe(transport%2C-channel%2C-%3Fopts)">§</a> <code>sunbeam.subscribe(transport, channel, ?opts)</code></h4><ul><li><code>transport &lt;String&gt;</code> The Websocket transport to use (<code>priv</code>, <code>pub</code>, <code>aux</code>)</li><li><code>channel &lt;String&gt;</code> The channel to subscribe to</li><li><code>opts &lt;Object&gt;</code> Additional data to send</li></ul><p>Subscribes to a Websocket channel.</p><p>Available channels for <code>priv</code>:</p><pre><code class="hljs"><span class="hljs-attr">book</span>            <span class="hljs-string">orderbooks</span>
<span class="hljs-attr">reports</span>         <span class="hljs-string">trade updates</span>
<span class="hljs-attr">wallets</span>         <span class="hljs-string">wallet snapshots / updates</span>
</code></pre><p>The channels <code>reports</code> and <code>wallets</code> are automatically subscribed on authentication via Websocket.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.subscribe(<span class="hljs-string">'priv'</span>, <span class="hljs-string">'wallets'</span>, { <span class="hljs-attr">account</span>: <span class="hljs-string">'testuser1431'</span> })
</code></pre><p><em>Sent Payload:</em></p><pre><code class="hljs">{
  <span class="hljs-attribute">event</span>: <span class="hljs-string">'subscribe'</span>,
  channel: <span class="hljs-string">'wallets'</span>,
  account: <span class="hljs-string">'testuser1431'</span>
}
</code></pre><h4 id="sunbeam.unsubscribe(transport%2C-channel%2C-%3Fopts)"><a class="header-anchor" href="#sunbeam.unsubscribe(transport%2C-channel%2C-%3Fopts)">§</a> <code>sunbeam.unsubscribe(transport, channel, ?opts)</code></h4><ul><li><code>transport &lt;String&gt;</code> The Websocket transport to use (<code>priv</code>, <code>pub</code>, <code>aux</code>)</li><li><code>channel &lt;String&gt;</code> The channel to subscribe to</li><li><code>opts &lt;Object&gt;</code> Additional data to send</li></ul><p>Unsubscribes from a channel.</p><p>The channels <code>reports</code> and <code>wallets</code> are automatically subscribed on authentication via Websocket.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.unsubscribe(<span class="hljs-string">'priv'</span>, <span class="hljs-string">'wallets'</span>, { <span class="hljs-attr">account</span>: <span class="hljs-string">'testuser1431'</span> })

</code></pre><p><em>Sent Payload:</em></p><pre><code class="hljs">{
  <span class="hljs-attribute">event</span>: <span class="hljs-string">'unsubscribe'</span>,
  channel: <span class="hljs-string">'wallets'</span>,
  account: <span class="hljs-string">'testuser1431'</span>
}
</code></pre><h4 id="websocket-api-helper-rpc-calls"><a class="header-anchor" href="#websocket-api-helper-rpc-calls">§</a> Websocket API helper RPC calls</h4><p>There are a few additional RPC calls that can help when writing your own client.</p><h5 id="chain-metadata---%7B-event%3A-%E2%80%98chain%E2%80%99-%7D"><a class="header-anchor" href="#chain-metadata---%7B-event%3A-%E2%80%98chain%E2%80%99-%7D">§</a> Chain metadata - { event: ‘chain’ }</h5><p>Returns metadata used for signing transactions via Websocket.</p><p>Format is:</p><pre><code class="hljs">[<span class="hljs-number">0</span>, 'ci', [
  $headBlockTime,
  $lastIrreversibleBlockNumber,
  $chainId,
  $refBlockPrefix
]]
</code></pre><p><em>Example:</em></p><pre><code class="hljs language-js">ws.on(<span class="hljs-string">'message'</span>, (m) =&gt; {
  <span class="hljs-built_in">console</span>.log(m)
})

ws.send(<span class="hljs-string">'pub'</span>, { <span class="hljs-attr">event</span>: <span class="hljs-string">'chain'</span> })
ws.send(<span class="hljs-string">'priv'</span>, { <span class="hljs-attr">event</span>: <span class="hljs-string">'chain'</span> })
</code></pre><p><em>Example response:</em></p><pre><code class="hljs">[ <span class="hljs-symbol">'0</span>',
  <span class="hljs-symbol">'ci</span>',
  [ <span class="hljs-symbol">'1557850696</span>',
    <span class="hljs-number">9296555</span>,
    <span class="hljs-symbol">'cf057bbfb72640471fd910bcb67639c22df9f92470936cddc1ade0e2f2e7dc4f</span>',
    <span class="hljs-symbol">'372320450</span>' ] ]
</code></pre><h5 id="trading-pairs---%7B-event%3A-%E2%80%98pa%E2%80%99-%7D"><a class="header-anchor" href="#trading-pairs---%7B-event%3A-%E2%80%98pa%E2%80%99-%7D">§</a> Trading pairs - { event: ‘pa’ }</h5><a id="trade-pairs"><p>Returns available trading pairs.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.on(<span class="hljs-string">'message'</span>, (m) =&gt; {
  <span class="hljs-built_in">console</span>.log(m)
})

ws.send(<span class="hljs-string">'pub'</span>, { <span class="hljs-attr">event</span>: <span class="hljs-string">'pairs'</span> })
ws.send(<span class="hljs-string">'priv'</span>, { <span class="hljs-attr">event</span>: <span class="hljs-string">'pairs'</span> })
</code></pre><p><em>Example response:</em></p><pre><code class="hljs">[ <span class="hljs-symbol">'0</span>',
  <span class="hljs-symbol">'pa</span>',
  [ <span class="hljs-symbol">'PIQ.PUSDT</span>', <span class="hljs-symbol">'EOX.PUSDT</span>', <span class="hljs-symbol">'PEOS.PUSDT</span>', <span class="hljs-symbol">'PEMT.PUSDT</span>' ] ]
</code></pre><h3 id="managed-state-updates"><a class="header-anchor" href="#managed-state-updates">§</a> Managed State Updates</h3><p>Usually the Bitfinex trading protocol will send a snapshot, and later just updates, for performance reasons.</p><p>When you register a <code>managed</code> orderbook handler, the managed state component will take care of parsing the snapshots update the state when partial updates arrive.</p><p>For every update, the full updated data is emitted.</p><h4 id="sunbeam.onmanagedorderbook(opts%2C-handler)"><a class="header-anchor" href="#sunbeam.onmanagedorderbook(opts%2C-handler)">§</a> <code>sunbeam.onManagedOrderbook(opts, handler)</code></h4><ul><li><code>opts &lt;Object&gt;</code><ul><li><code>symbol &lt;String&gt;</code> The symbol to emit the orderbook update for, i.e. <code>EOX.USDT</code></li></ul></li><li><code>handler &lt;Function&gt;</code> Called every time the state is updated</li></ul><p>The input format is <code>R0</code>: <a href="https://docs.bitfinex.com/v2/reference#ws-public-raw-order-books">https://docs.bitfinex.com/v2/reference#ws-public-raw-order-books</a></p><p>If you want to manage state on your own, our just need a stream of updates, use the <code>onOrderbook</code> handler.</p><p><em>Example:</em></p><pre><code class="hljs language-js"><span class="hljs-keyword">const</span> pair = <span class="hljs-string">'EOS.USDT'</span>

ws.onManagedOrderbook({ <span class="hljs-attr">symbol</span>: pair }, (ob) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`ws.onManagedOrderbook({ symbol: <span class="hljs-subst">${pair}</span> })`</span>)
  <span class="hljs-built_in">console</span>.log(ob)

  ws.unsubscribeOrderbook(pair)
})
</code></pre><p>Registered for messages from the corresponding book channel (received on subscribe).</p><h4 id="sunbeam.onmanagedwallet(opts%2C-handler)"><a class="header-anchor" href="#sunbeam.onmanagedwallet(opts%2C-handler)">§</a> <code>sunbeam.onManagedWallet(opts, handler)</code></h4><ul><li><code>opts &lt;Object&gt;</code></li><li><code>handler &lt;Function&gt;</code> Called every time the state is updated</li></ul><p><em>Example:</em></p><pre><code class="hljs language-js">ws.onManagedWallet({}, (mw) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ws.onManagedWallet'</span>)
  <span class="hljs-built_in">console</span>.log(mw)
})

ws.auth()
</code></pre><p>Registered for <code>ws</code>, <code>wu</code> messages via channel <code>0</code>. Channel is automatically subscribed by the API when doing an auth.</p><h4 id="sunbeam.onmanagedorders(filter%2C-handler)"><a class="header-anchor" href="#sunbeam.onmanagedorders(filter%2C-handler)">§</a> <code>sunbeam.onManagedOrders(filter, handler)</code></h4><ul><li><code>opts &lt;Object&gt;</code></li><li><code>handler &lt;Function&gt;</code> Called every time the state is updated</li></ul><p><em>Example:</em></p><pre><code class="hljs language-js">ws.onManagedOrders({}, (orders) =&gt; {
  <span class="hljs-built_in">console</span>.log(orders)
})
ws.auth()
</code></pre><p>Registered for <code>os</code>, <code>on</code>, <code>ou</code>, <code>oc</code> messages via channel <code>0</code>.</p><h3 id="plain-updates"><a class="header-anchor" href="#plain-updates">§</a> Plain updates</h3><p>If you want to manage state on your own, or have a special use case, you can use unmanaged handlers.</p><h4 id="sunbeam.onwallet(opts%2C-handler)"><a class="header-anchor" href="#sunbeam.onwallet(opts%2C-handler)">§</a> <code>sunbeam.onWallet(opts, handler)</code></h4><ul><li><code>opts &lt;Object&gt;</code></li><li><code>handler &lt;Function&gt;</code> Called every time the state is updated</li></ul><p><em>Example:</em></p><pre><code class="hljs language-js">ws.onWallet({}, (wu) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ws.onWallet'</span>)
  <span class="hljs-built_in">console</span>.log(wu)
})

ws.auth()
</code></pre><p>Registered for <code>ws</code>, <code>wu</code> messages via channel <code>0</code>. Channel is automatically subscribed by the API when doing an auth.</p><h4 id="sunbeam.onorders(opts%2C-handler)"><a class="header-anchor" href="#sunbeam.onorders(opts%2C-handler)">§</a> <code>sunbeam.onOrders(opts, handler)</code></h4><ul><li><code>opts &lt;Object&gt;</code> <code>?symbol &lt;String&gt;</code> optional: filter by pair</li><li><code>handler &lt;Function&gt;</code> The callback called for every update</li></ul><p><em>Example:</em></p><pre><code class="hljs language-js"><span class="hljs-keyword">const</span> pair = <span class="hljs-string">'EOS.USDT'</span>

ws.onOrders({}, (data) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ws.onOrders({})'</span>)
  <span class="hljs-built_in">console</span>.log(data)
})

<span class="hljs-comment">// filter enabled</span>
ws.onOrders({ <span class="hljs-attr">symbol</span>: pair }, (data) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`ws.onOrders({ symbol: <span class="hljs-subst">${pair}</span> })`</span>)
  <span class="hljs-built_in">console</span>.log(data)
})

ws.auth()
</code></pre><p>Registered for <code>os</code>, <code>on</code>, <code>ou</code>, <code>oc</code> messages via channel <code>0</code>.</p><h4 id="sunbeam.onprivatetrades(opts%2C-handler)"><a class="header-anchor" href="#sunbeam.onprivatetrades(opts%2C-handler)">§</a> <code>sunbeam.onPrivateTrades(opts, handler)</code></h4><ul><li><code>opts &lt;Object&gt;</code></li><li><code>handler &lt;Function&gt;</code> The callback called for every update</li></ul><p>Called when an own, submitted order matches.</p><p><em>Example:</em></p><pre><code class="hljs language-js">ws.onPrivateTrades({}, (data) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ws.onPrivateTrades({})'</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'private trade'</span>, data) <span class="hljs-comment">// emits [ 'ETH.USD', 'te', [ '3', 1537196302500, -0.9, 1 ] ]</span>
})

ws.auth()
</code></pre><p>Registered for <code>tu</code>, <code>te</code> messages via channel <code>0</code>.</p><h4 id="sunbeam.onpublictrades(opts%2C-handler)"><a class="header-anchor" href="#sunbeam.onpublictrades(opts%2C-handler)">§</a> <code>sunbeam.onPublicTrades(opts, handler)</code></h4><ul><li><code>opts &lt;Object&gt;</code><ul><li><code>?symbol &lt;String&gt;</code> optional: the symbol to emit the public trade updates for, i.e. <code>EOX.USDT</code></li></ul></li><li><code>handler &lt;Function&gt;</code> The callback called for every update</li></ul><p><em>Example:</em></p><pre><code class="hljs language-js"><span class="hljs-keyword">const</span> pair = <span class="hljs-string">'EOS.USDT'</span>

ws.onPublicTrades({}, (data) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`ws.onPublicTrades({})`</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'public trade'</span>, data)
})

ws.onPublicTrades({ <span class="hljs-attr">symbol</span>: pair }, (data) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`ws.onPublicTrades({ symbol: <span class="hljs-subst">${pair}</span> })`</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'public trade'</span>, data)
})

ws.subscribePublicTrades(<span class="hljs-string">'EOX.USDT'</span>)
</code></pre><p>Registered for <code>tu</code>, <code>te</code> messages via the corresponding channel for the symbol.</p><h4 id="sunbeam.onorderbook(opts%2C-handler)"><a class="header-anchor" href="#sunbeam.onorderbook(opts%2C-handler)">§</a> <code>sunbeam.onOrderbook(opts, handler)</code></h4><ul><li><code>opts &lt;Object&gt;</code><ul><li><code>symbol &lt;String&gt;</code> The symbol to emit the orderbook update for, i.e. <code>EOX.USDT</code></li></ul></li><li><code>handler &lt;Function&gt;</code> The callback called for every update</li></ul><p>Just emits order updates and order snapshots without keeping or managing state.</p><p><em>Example:</em></p><pre><code class="hljs language-js"><span class="hljs-keyword">const</span> pair = <span class="hljs-string">'EOS.USDT'</span>

ws.onOrderbook({ <span class="hljs-attr">symbol</span>: pair }, (ob) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`ws.onOrderbook({ symbol: <span class="hljs-subst">${pair}</span> })`</span>)
  <span class="hljs-built_in">console</span>.log(ob)
})

ws.subscribeOrderbook(pair)
</code></pre><p>Registered for messages from the corresponding book channel (received on subscribe).</p><h2 id="standalone-managed-state-helper"><a class="header-anchor" href="#standalone-managed-state-helper">§</a> Standalone Managed State Helper</h2><p>Sunbeam can take care of managing state snapshots for you, and keeps them up to date when the API sends updates. Sometimes you may want to interact with Sunbeam’s managed state. They are exposed through <code>this.state</code></p><pre><code class="hljs language-js">
ws.state
</code></pre><h2 id="setup-your-node"><a class="header-anchor" href="#setup-your-node">§</a> Setup your node</h2><p>Start nodeos:</p><pre><code class="hljs"><span class="hljs-string">nodeos </span><span class="hljs-built_in">--access-control-allow-origin</span> <span class="hljs-string">"*"</span> <span class="hljs-built_in">--verbose-http-error</span> <span class="hljs-built_in">--http-validate-host=false</span> <span class="hljs-built_in">--enable-stale-production</span> <span class="hljs-built_in">--producer-name</span> <span class="hljs-string">eosio </span><span class="hljs-built_in">--plugin</span> <span class="hljs-string">eosio:</span>:<span class="hljs-string">chain_api_plugin </span><span class="hljs-built_in">--plugin</span> <span class="hljs-string">eosio:</span>:<span class="hljs-string">net_api_plugin
</span></code></pre><p><code>--contracts-console</code> will output the logging from custom contracts</p><h3 id="browsers"><a class="header-anchor" href="#browsers">§</a> Browsers</h3><p>Enable CORS for your EOS node, by enabling it via config:</p><pre><code class="hljs"><span class="hljs-keyword">cd</span> ~<span class="hljs-string">/eosdata/</span>

<span class="hljs-keyword">echo</span> <span class="hljs-string">"access-control-allow-origin = *"</span> &gt;&gt; config.ini
</code></pre></div></div><!--
      <div id="bfx-oss-docs-footer-bar">
        <div id="bfx-oss-docs-footer-bar__container">
          <p>Copyright © 2013-2020 iFinex Inc. All rights reserved.</p>
        </div>
      </div>
      --></div><script type="text/javascript" src="js/vendor/debug.min.js"></script><script type="text/javascript" src="js/vendor/lodash.min.js"></script><script type="text/javascript" src="js/vendor/zepto.min.js"></script><script type="text/javascript" src="js/vendor/perfect-scrollbar.min.js"></script><script type="text/javascript" src="js/main.js"></script></body></html>