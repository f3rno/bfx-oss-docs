<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width,initial-scale=1"><meta charset="utf-8"><link rel="stylesheet" type="text/css" href="css/normalize.css"><link rel="stylesheet" type="text/css" href="css/perfect-scrollbar.css"><link rel="stylesheet" type="text/css" href="css/highlightjs/night-owl.css"><link rel="stylesheet" type="text/css" href="index.css"><title>README | grenache-nodejs-utp</title></head><body><div id="bfx-oss-docs-side-bar"><div id="bfx-oss-docs-side-bar__header"><img src="img/bfx-logo-bg-white.png" alt="Bitfinex" height="63"></div><ul><li><a href="index.html"><p>Home</p></a></li><li><a href="page_md_render_test.html"><p>Markdown Render Test</p></a></li><li><a href="/page_libraries_bitfinex_api_py_README.html"><img src="/svg/icons/python.svg"><p>bitfinex-api-py</p></a></li><li><a href="/page_libraries_bitfinex_api_go_README.html"><img src="/svg/icons/go.svg"><p>bitfinex-api-go</p></a></li><li><a href="/page_libraries_bfxfixgw_README.html"><img src="/svg/icons/go.svg"><p>bfxfixgw</p></a></li><li><a href="/page_libraries_bitfinex_api_rb_README.html"><img src="/svg/icons/ruby.svg"><p>bitfinex-api-rb</p></a></li><li><a href="/page_libraries_bitfinex_api_node_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bitfinex-api-node</p></a></li><li><a href="/page_libraries_bfx_api_mock_srv_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-mock-srv</p></a></li><li><a href="/page_libraries_bfx_api_node_core_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-core</p></a></li><li><a href="/page_libraries_bfx_api_node_models_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-models</p></a></li><li><a href="/page_libraries_bfx_api_node_plugin_example_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-example</p></a></li><li><a href="/page_libraries_bfx_api_node_plugin_managed_candles_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-managed-candles</p></a></li><li><a href="/page_libraries_bfx_api_node_plugin_managed_ob_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-managed-ob</p></a></li><li><a href="/page_libraries_bfx_api_node_plugin_ob_checksum_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-ob-checksum</p></a></li><li><a href="/page_libraries_bfx_api_node_plugin_seq_audit_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-seq-audit</p></a></li><li><a href="/page_libraries_bfx_api_node_plugin_wd_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-wd</p></a></li><li><a href="/page_libraries_bfx_api_node_rest_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-rest</p></a></li><li><a href="/page_libraries_bfx_api_node_util_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-util</p></a></li><li><a href="/page_libraries_bfx_api_node_ws1_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-api-node-ws1</p></a></li><li><a href="/page_libraries_bfx_hf_backtest_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-backtest</p></a></li><li><a href="/page_libraries_bfx_hf_chart_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-chart</p></a></li><li><a href="/page_libraries_bfx_hf_data_server_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-data-server</p></a></li><li><a href="/page_libraries_bfx_hf_ext_plugin_bitfinex_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-ext-plugin-bitfinex</p></a></li><li><a href="/page_libraries_bfx_hf_ext_plugin_dummy_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-ext-plugin-dummy</p></a></li><li><a href="/page_libraries_bfx_hf_indicators_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-indicators</p></a></li><li><a href="/page_libraries_bfx_hf_models_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-models</p></a></li><li><a href="/page_libraries_bfx_hf_models_adapter_lowdb_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-lowdb</p></a></li><li><a href="/page_libraries_bfx_hf_models_adapter_sql_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-sql</p></a></li><li><a href="/page_libraries_bfx_hf_models_adapter_template_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-template</p></a></li><li><a href="/page_libraries_bfx_hf_algo_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-algo</p></a></li><li><a href="/page_libraries_bfx_hf_server_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-server</p></a></li><li><a href="/page_libraries_bfx_hf_strategy_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-strategy</p></a></li><li><a href="/page_libraries_bfx_hf_strategy_exec_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-strategy-exec</p></a></li><li><a href="/page_libraries_bfx_hf_ui_config_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-ui-config</p></a></li><li><a href="/page_libraries_bfx_hf_util_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-hf-util</p></a></li><li><a href="/page_libraries_bfx_ws2_api_audit_README.html"><img src="/svg/icons/nodejs_small.svg"><p>bfx-ws2-api-audit</p></a></li><li><a href="/page_libraries_cbq_js_README.html"><img src="/svg/icons/nodejs_small.svg"><p>cbq-js</p></a></li><li><a href="/page_libraries_caron_README.html"><img src="/svg/icons/nodejs_small.svg"><p>caron</p></a></li><li><a href="/page_libraries_eos_name_verify_README.html"><img src="/svg/icons/nodejs_small.svg"><p>eos-name-verify</p></a></li><li><a href="/page_libraries_grenache_browser_http_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-browser-http</p></a></li><li><a href="/page_libraries_grenache_grape_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-grape</p></a></li><li><a href="/page_libraries_grenache_nodejs_base_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-nodejs-base</p></a></li><li><a href="/page_libraries_grenache_nodejs_http_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-nodejs-http</p></a></li><li><a href="/page_libraries_grenache_nodejs_link_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-nodejs-link</p></a></li><li class="active"><a href="/page_libraries_grenache_nodejs_utp_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-nodejs-utp</p></a><ul><li class="active"><a href="page_libraries_grenache_nodejs_utp_README.html"><p>- README</p></a></li><li><a href="page_libraries_grenache_nodejs_utp_reference.html"><p>- API Reference</p></a></li></ul></li><li><a href="/page_libraries_grenache_nodejs_ws_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-nodejs-ws</p></a></li><li><a href="/page_libraries_grenache_nodejs_ws_tls_README.html"><img src="/svg/icons/nodejs_small.svg"><p>grenache-nodejs-ws-tls</p></a></li><li><a href="/page_libraries_lib_js_util_currencies_README.html"><img src="/svg/icons/nodejs_small.svg"><p>lib-js-util-currencies</p></a></li><li><a href="/page_libraries_lib_js_util_math_README.html"><img src="/svg/icons/nodejs_small.svg"><p>lib-js-util-math</p></a></li><li><a href="/page_libraries_lib_js_util_number_README.html"><img src="/svg/icons/nodejs_small.svg"><p>lib-js-util-number</p></a></li><li><a href="/page_libraries_lib_js_util_symbol_README.html"><img src="/svg/icons/nodejs_small.svg"><p>lib-js-util-symbol</p></a></li><li><a href="/page_libraries_smidgen_README.html"><img src="/svg/icons/nodejs_small.svg"><p>smidgen</p></a></li><li><a href="/page_libraries_sunbeam_README.html"><img src="/svg/icons/nodejs_small.svg"><p>sunbeam</p></a></li><li><a href="/page_libraries_wasteland_README.html"><img src="/svg/icons/nodejs_small.svg"><p>wasteland</p></a></li></ul></div><div id="bfx-oss-docs-content"><div id="bfx-oss-docs-header-bar"><h2>README</h2><h2>grenache-nodejs-utp</h2></div><div id="bfx-oss-docs-content-wrapper" class="bfx-oss-docs-content-type-api-docs"><div class="bfx-oss-docs-md-content bfx-oss-docs-code-wrapper"><div id="bfx-oss-docs-api-docs-index"><div id="bfx-oss-docs-api-docs-index__inner"><nav class="bfx-oss-docs-md-toc"><ol><li><a href="#grenache-node.js-utp-implementation">Grenache Node.JS UTP implementation</a><ol><li><a href="#setup">Setup</a><ol><li><a href="#install">Install</a></li><li><a href="#api">API</a></li><li><a href="#other-requirements">Other Requirements</a></li><li><a href="#testing%3A-with-just-one-party-behin-a-nat">Testing: with just one party behin a NAT</a><ol><li><a href="#instructions">Instructions</a></li></ol></li><li><a href="#testing%3A-with-broker">Testing: with broker</a><ol><li><a href="#instructions-2">Instructions</a></li></ol></li></ol></li></ol></li></ol></nav></div></div><h1 id="grenache-node.js-utp-implementation"><a class="header-anchor" href="#grenache-node.js-utp-implementation">ยง</a> <a href="https://github.com/bitfinexcom/grenache">Grenache</a> Node.JS UTP implementation</h1><img src="logo.png" width="15%"><p>Grenache is a micro-framework for connecting microservices. Its simple and optimized for performance.</p><p>Internally, Grenache uses Distributed Hash Tables (DHT, known from Bittorrent) for Peer to Peer connections. You can find more details how Grenche internally works at the <a href="https://github.com/bitfinexcom/grenache">Main Project Homepage</a></p><ul><li><a href="#setup">Setup</a></li><li><a href="#examples">Examples</a></li><li><a href="#api">API</a></li></ul><h2 id="setup"><a class="header-anchor" href="#setup">ยง</a> Setup</h2><h3 id="install"><a class="header-anchor" href="#install">ยง</a> Install</h3><pre><code class="hljs">npm <span class="hljs-keyword">install</span> <span class="hljs-comment">--save grenache-nodejs-utp</span>
</code></pre><h3 id="api"><a class="header-anchor" href="#api">ยง</a> API</h3><p><a href="/examples/">/examples/</a></p><h3 id="other-requirements"><a class="header-anchor" href="#other-requirements">ยง</a> Other Requirements</h3><p>Install <code>Grenache Grape</code>: <a href="https://github.com/bitfinexcom/grenache-grape:">https://github.com/bitfinexcom/grenache-grape:</a></p><pre><code class="hljs language-bash">npm i -g grenache-grape
</code></pre><pre><code class="hljs">// <span class="hljs-string">Start </span>2 <span class="hljs-string">Grapes
</span><span class="hljs-string">grape </span><span class="hljs-built_in">--dp</span> <span class="hljs-string">20001 </span><span class="hljs-built_in">--aph</span> <span class="hljs-string">30001 </span><span class="hljs-built_in">--bn</span> <span class="hljs-string">'127.0.0.1:20002'</span>
<span class="hljs-string">grape </span><span class="hljs-built_in">--dp</span> <span class="hljs-string">20002 </span><span class="hljs-built_in">--aph</span> <span class="hljs-string">40001 </span><span class="hljs-built_in">--bn</span> <span class="hljs-string">'127.0.0.1:20001'</span>
</code></pre><h3 id="testing%3A-with-just-one-party-behin-a-nat"><a class="header-anchor" href="#testing%3A-with-just-one-party-behin-a-nat">ยง</a> Testing: with just one party behin a NAT</h3><p>In a lot of scenarios just one party is behind a NAT and the other is available with a public port and IP.</p><h4 id="instructions"><a class="header-anchor" href="#instructions">ยง</a> Instructions</h4><p>Run a Grape instance on the public server, lets say the server has the IP <code>157.81.109.241</code>:</p><pre><code class="hljs"><span class="hljs-string">DEBUG=</span>* <span class="hljs-string">grape </span><span class="hljs-built_in">--dp</span> <span class="hljs-string">20001 </span><span class="hljs-built_in">--aph</span> <span class="hljs-string">30001 </span><span class="hljs-built_in">--bn</span> <span class="hljs-string">'127.0.0.1:20002'</span>
</code></pre><p>Then start a Grape instance locally on your machine, behind a NAT, and connect it to the other Grape:</p><pre><code class="hljs"><span class="hljs-string">DEBUG=</span>* <span class="hljs-string">grape </span><span class="hljs-built_in">--dp</span> <span class="hljs-string">20002 </span><span class="hljs-built_in">--aph</span> <span class="hljs-string">30001 </span><span class="hljs-built_in">--bn</span> <span class="hljs-string">'157.81.109.241:20001'</span>
</code></pre><p>You should see both Grapes connecting to each other.</p><p>Start the party which runs on the public server. It will announce itself as <code>fibonacci_consumer</code> on the network:</p><pre><code class="hljs"><span class="hljs-keyword">node</span> <span class="hljs-title">examples</span>/punch_simple_servers/rpc_server_public.js
</code></pre><p>Start <code>rpc_server_behind_nat.js</code> on your local machine behind the router now. It looks up possible consumers and sends a UDP packet to the consumer. This establishes a temporary ad-hoc routing for the service running in the home network.</p><p>When the packet arrives at the public server, it will emit a <code>punch</code> event. The public server handles the event and gets the IP/port from the ad-hoc routing. It then kicks of the request for calculation.</p><pre><code class="hljs"><span class="hljs-keyword">node</span> <span class="hljs-title">examples</span>/punch_simple_servers/rpc_server_behind_nat.js
</code></pre><h3 id="testing%3A-with-broker"><a class="header-anchor" href="#testing%3A-with-broker">ยง</a> Testing: with broker</h3><p>In case both services are behin a NAT, we have to make use of a shared and common broker. This can be a normal server which is reachable by both parties by an address and port kown from all parties.</p><h4 id="instructions-2"><a class="header-anchor" href="#instructions-2">ยง</a> Instructions</h4><p>Run a Grape instance on a server, lets say the server has the IP <code>157.81.109.241</code>:</p><pre><code class="hljs"><span class="hljs-string">DEBUG=</span>* <span class="hljs-string">grape </span><span class="hljs-built_in">--dp</span> <span class="hljs-string">20001 </span><span class="hljs-built_in">--aph</span> <span class="hljs-string">30001 </span><span class="hljs-built_in">--bn</span> <span class="hljs-string">'127.0.0.1:20002'</span>
</code></pre><p>Then start a Grape instance locally on your machine, behind a NAT, and connect it to the other Grape:</p><pre><code class="hljs"><span class="hljs-string">DEBUG=</span>* <span class="hljs-string">grape </span><span class="hljs-built_in">--dp</span> <span class="hljs-string">20002 </span><span class="hljs-built_in">--aph</span> <span class="hljs-string">30001 </span><span class="hljs-built_in">--bn</span> <span class="hljs-string">'157.81.109.241:20001'</span>
</code></pre><p>On your remote server, start the broker:</p><pre><code class="hljs"><span class="hljs-keyword">node</span> <span class="hljs-title">examples</span>/nat_w_broker/broker.js
</code></pre><p>On your local machine behind the NAT, start the service:</p><pre><code class="hljs"><span class="hljs-keyword">node</span> <span class="hljs-title">examples</span>/nat_w_broker/nat_server.js
</code></pre><p>From your external server, you should be able to connect to the machine behind the NAT now:</p><pre><code class="hljs"><span class="hljs-keyword">node</span> <span class="hljs-title">examples</span>/nat_w_broker/rpc_client.js
</code></pre></div></div><!--
      <div id="bfx-oss-docs-footer-bar">
        <div id="bfx-oss-docs-footer-bar__container">
          <p>Copyright ยฉ 2013-2020 iFinex Inc. All rights reserved.</p>
        </div>
      </div>
      --></div><script type="text/javascript" src="js/vendor/debug.min.js"></script><script type="text/javascript" src="js/vendor/lodash.min.js"></script><script type="text/javascript" src="js/vendor/zepto.min.js"></script><script type="text/javascript" src="js/vendor/perfect-scrollbar.min.js"></script><script type="text/javascript" src="js/main.js"></script></body></html>